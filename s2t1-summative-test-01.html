<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Merchandising Summative Test 01</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    
    <style>
        /* Times New Roman Font Application */
        body {
            font-family: 'Times New Roman', Times, serif;
            background-color: #f4f6f8;
            /* ENHANCEMENT: Disable Text Selection */
            -webkit-user-select: none; /* Safari */
            -ms-user-select: none; /* IE 10 and IE 11 */
            user-select: none; /* Standard syntax */
        }
        
        /* Custom style to lock scrolling */
        .no-scroll {
            overflow: hidden;
            height: 100vh; 
        }

        /* Class for the printed PDF output only */
        .print-layout {
            font-family: 'Times New Roman', Times, serif;
            font-size: 11pt;
            padding: 0.5in;
            background: white;
            position: relative;
            min-height: 100%;
            /* Allow selection in print preview so PDF generation works */
            user-select: text; 
        }
        
        /* PDF-specific styling for correct/incorrect */
        .feedback-correct {
            background-color: #f0fdf4; /* green-50 */
            border: 1px solid #bbf7d0; /* green-200 */
            border-radius: 0.5rem;
            padding: 0.5rem;
            margin-top: 5px;
        }
        .feedback-incorrect {
            background-color: #fef2f2; /* red-50 */
            border: 1px solid #fecaca; /* red-200 */
            border-radius: 0.5rem;
            padding: 0.5rem;
            margin-top: 5px;
        }

        /* Question Palette Styles */
        .q-dot {
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            font-size: 12px;
            font-weight: bold;
            cursor: pointer;
            border: 2px solid #e5e7eb;
            transition: all 0.2s;
            font-family: 'Inter', sans-serif; /* Keep UI elements legible */
        }
        .q-dot.active {
            background-color: #3b82f6;
            color: white;
            border-color: #3b82f6;
        }
        .q-dot.answered {
            background-color: #dcfce7; /* green-100 */
            border-color: #22c55e; /* green-500 */
            color: #166534;
        }
        .q-dot.active.answered {
            background-color: #15803d; /* green-700 */
            color: white;
        }
        
        /* Print Specific Utilities */
        .print-rubric {
            background-color: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            padding: 10px;
            margin-bottom: 15px;
            font-size: 0.9rem;
            color: #000;
        }

        /* Footer Styling */
        .print-footer {
            margin-top: 30px;
            padding-top: 10px;
            border-top: 1px solid #000;
            width: 100%;
            font-family: 'Times New Roman', Times, serif;
        }
        
        .footer-line-1 {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-weight: bold;
            font-size: 10pt;
        }

        .footer-line-2 {
            display: flex;
            justify-content: center;
            margin-top: 5px;
        }

        .footer-box {
            border: 1px solid #000;
            padding: 2px 10px;
            font-style: italic;
            font-size: 9pt;
            text-align: center;
        }

        /* Loader */
        .loader {
            border: 4px solid #f3f3f3;
            border-radius: 50%;
            border-top: 4px solid #3498db;
            width: 20px;
            height: 20px;
            -webkit-animation: spin 2s linear infinite; /* Safari */
            animation: spin 2s linear infinite;
            display: inline-block;
            vertical-align: middle;
            margin-left: 10px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* ENHANCEMENT: Black Screen Curtain for Copy/Screenshot Protection */
        #black-curtain {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-color: black;
            z-index: 9999;
        }

    </style>
</head>
<body class="min-h-screen antialiased no-scroll relative" oncontextmenu="return false;">

    <div id="black-curtain"></div>

    <div id="security-overlay" class="fixed inset-0 bg-gray-900 z-[60] flex items-center justify-center text-white p-6 text-center">
        <div>
            <h1 class="text-3xl font-bold mb-4 text-red-500">Access Denied</h1>
            <p id="security-msg" class="text-xl">Validating link parameters...</p>
        </div>
    </div>

    <div id="cheat-lockout" class="hidden fixed inset-0 bg-gray-900 z-[100] flex items-center justify-center text-white p-6 text-center">
        <div class="max-w-md w-full">
            <div class="text-6xl mb-4">‚ö†Ô∏è</div>
            <h1 class="text-3xl font-bold mb-4 text-red-500">Test Paused</h1>
            <p class="text-lg mb-6">Focus lost. Navigation away from the test is monitored.</p>
            
            <div class="bg-gray-800 p-4 rounded-lg border border-gray-700 mb-6">
                <p class="text-sm text-gray-400">To resume, click the button below <span class="font-bold text-white">3 times</span>.</p>
            </div>

            <button id="btn-unlock" onclick="window.handleUnlockClick()" class="w-full py-4 bg-red-600 hover:bg-red-700 text-white font-bold rounded-lg text-xl shadow-lg transition-transform transform active:scale-95">
                Resume Test (3)
            </button>
        </div>
    </div>

    <div id="timer-bar" class="hidden fixed top-0 left-0 w-full bg-red-600 text-white z-50 px-4 py-2 shadow-md flex justify-between items-center">
        <span class="font-bold font-serif text-lg">TIME REMAINING</span>
        <span id="timer-display" class="font-mono text-2xl font-bold">00:00:00</span>
    </div>

    <div id="app" class="max-w-5xl mx-auto p-4 md:p-6 pt-16">

        <section id="student-info-section" class="hidden bg-white p-8 rounded-xl shadow-2xl mb-6 border-t-8 border-blue-800 max-w-2xl mx-auto mt-10">
            
            <img src="./shs-adc-logo.png" alt="School Logo" class="mx-auto mb-2 h-20 w-auto" />
            <h2 class="text-3xl font-extrabold text-gray-800 mb-2 text-center font-serif">SUMMATIVE TEST</h2>
            <p class="text-center text-gray-500 mb-8 font-serif italic">Merchandising Business Mastery</p>
            
            <div class="space-y-4">
                <div class="bg-blue-50 p-4 rounded-lg border border-blue-200">
                    <h3 class="text-blue-800 font-bold mb-3 border-b border-blue-200 pb-1">Attendance Verification</h3>
                    <div class="grid grid-cols-1 md:grid-cols-1 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">ID Number</label>
                            <input type="text" id="id-number" placeholder="Enter your Student ID" class="w-full p-2 border border-gray-300 rounded focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        <input type="hidden" id="attendance-record">
                    </div>
                    <button onclick="window.checkAttendance()" class="mt-3 w-full py-2 bg-blue-600 text-white text-sm font-bold rounded hover:bg-blue-700 transition flex justify-center items-center">
                        Verify ID & Load Data <span id="loading-spinner" class="loader hidden"></span>
                    </button>
                    <p id="firebase-msg" class="text-xs mt-2 text-center min-h-[1rem]"></p>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Class Number</label>
                        <input type="number" id="class-number" class="w-full p-3 border border-gray-300 rounded-lg bg-gray-50" readonly>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Grade Level & Section</label>
                        <input type="text" id="grade-section" class="w-full p-3 border border-gray-300 rounded-lg bg-gray-50" readonly>
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Full Name</label>
                    <input type="text" id="full-name" class="w-full p-3 border border-gray-300 rounded-lg bg-gray-50" readonly>
                </div>
            </div>

            <button id="btn-start-exam" onclick="window.initializeTest()" class="mt-8 w-full px-4 py-3 bg-gray-400 text-white font-bold text-lg rounded-lg shadow-lg cursor-not-allowed font-serif" disabled>
                Start Examination
            </button>
        </section>

        <div id="main-interface" class="hidden">
            
            <header class="bg-white shadow-lg rounded-xl mb-6 overflow-hidden">
                <div class="bg-blue-900 text-white p-4 flex justify-between items-center">
                    <div>
                        <h1 class="text-xl font-bold font-serif">SUMMATIVE TEST</h1>
                        <p class="text-xs text-blue-200 font-serif" id="student-display-name">Student Name</p>
                    </div>
                    <div class="text-right">
                        <button onclick="window.finishAndPreview()" class="bg-green-500 hover:bg-green-600 text-white text-sm font-bold py-2 px-4 rounded shadow font-serif">
                            Submit & Print Results
                        </button>
                    </div>
                </div>

                <nav class="flex overflow-x-auto bg-gray-50 border-b border-gray-200">
                    <button onclick="window.switchTestPart(1)" id="tab-1" class="flex-1 py-4 px-6 text-sm font-bold text-gray-500 hover:text-blue-800 border-b-4 border-transparent hover:border-blue-300 transition-all whitespace-nowrap font-serif">
                        TEST 1: Theory MC Questions
                    </button>
                    <button onclick="window.switchTestPart(2)" id="tab-2" class="flex-1 py-4 px-6 text-sm font-bold text-gray-500 hover:text-blue-800 border-b-4 border-transparent hover:border-blue-300 transition-all whitespace-nowrap font-serif">
                        TEST 2: Problem Solving MC Questions
                    </button>
                </nav>
            </header>

            <div class="flex flex-col lg:flex-row gap-6">
                
                <div class="flex-1">
                    <div id="question-card" class="bg-white p-6 rounded-xl shadow-md min-h-[400px] relative">
                        <div id="question-content"></div>
                        
                        <div class="mt-8 flex justify-between items-center pt-4 border-t border-gray-100">
                            <button onclick="window.prevQuestion()" id="btn-prev" class="px-4 py-2 rounded-lg border border-gray-300 text-gray-600 hover:bg-gray-50 font-medium flex items-center font-serif">
                                ‚Üê Previous
                            </button>
                            <span id="question-counter" class="text-sm text-gray-500 font-mono">1 / 25</span>
                            <button onclick="window.nextQuestion()" id="btn-next" class="px-4 py-2 rounded-lg bg-blue-600 text-white hover:bg-blue-700 font-medium flex items-center font-serif">
                                Next ‚Üí
                            </button>
                        </div>
                    </div>
                </div>

                <div class="w-full lg:w-64 flex-shrink-0">
                    <div class="bg-white p-4 rounded-xl shadow-md">
                        <h3 class="text-sm font-bold text-gray-700 mb-3 uppercase tracking-wider font-serif">Question Navigator</h3>
                        <div id="question-palette" class="grid grid-cols-5 gap-2">
                            </div>
                        <div class="mt-4 text-xs text-gray-500 flex flex-col gap-1 font-serif">
                            <div class="flex items-center"><span class="w-3 h-3 rounded-full border border-gray-300 mr-2"></span> Unanswered</div>
                            <div class="flex items-center"><span class="w-3 h-3 rounded-full bg-blue-500 mr-2"></span> Current</div>
                            <div class="flex items-center"><span class="w-3 h-3 rounded-full bg-green-100 border border-green-500 mr-2"></span> Answered</div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <div id="print-preview-modal" class="hidden fixed inset-0 bg-gray-800 bg-opacity-95 z-[70] flex justify-center items-start overflow-y-auto pt-10 pb-10">
        <div class="bg-white w-full max-w-4xl rounded-lg shadow-2xl flex flex-col max-h-[90vh]">
            <div class="p-4 border-b flex justify-between items-center bg-gray-50 rounded-t-lg">
                <h2 class="text-xl font-bold text-gray-800 font-serif">Result Preview</h2>
                <div class="space-x-2" id="preview-actions"></div>
            </div>
            <div id="print-content" class="p-8 overflow-y-auto print-layout">
                </div>
        </div>
    </div>

    <div id="submission-overlay" class="hidden fixed inset-0 bg-white bg-opacity-90 z-[80] flex flex-col items-center justify-center text-blue-900">
        <div class="loader" style="width: 50px; height: 50px; border-width: 6px;"></div>
        <p class="mt-4 text-xl font-bold">Submitting Results to Server...</p>
        <p class="text-sm">Please wait. Do not close this window.</p>
    </div>

    <script type="module">
        // üîπ FIREBASE SETUP & LOGIC
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.0.0/firebase-app.js";
        import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/10.0.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAgOsKAZWwExUzupxSNytsfOo9BOppF0ng",
            authDomain: "jlvcpa-quizzes.firebaseapp.com",
            projectId: "jlvcpa-quizzes",
            storageBucket: "jlvcpa-quizzes.appspot.com",
            messagingSenderId: "629158256557",
            appId: "1:629158256557:web:b3d1a424b32e28cd578b24"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // URL PARAMS & SECURITY CHECK
        window.onload = function() {
            const urlParams = new URLSearchParams(window.location.search);
            const attendanceId = urlParams.get('att');
            const expiry = urlParams.get('exp');
            const duration = urlParams.get('dur');
            const overlay = document.getElementById('security-overlay');
            const msg = document.getElementById('security-msg');

            if (!attendanceId || !expiry || !duration) {
                msg.innerText = "Invalid Link: Missing parameters.";
                return; 
            }

            const now = new Date().getTime();
            if (now > parseInt(expiry)) {
                msg.innerText = "This quiz link has expired.";
                return;
            }

            // Set values
            document.getElementById('attendance-record').value = attendanceId;
            window.examDurationMins = parseInt(duration);
            
            // Unlock
            overlay.classList.add('hidden');
            document.getElementById('student-info-section').classList.remove('hidden');
        };

        // Check Attendance against Param ID
        window.checkAttendance = async function() {
            const recordId = document.getElementById('attendance-record').value; // From URL
            const idNumber = document.getElementById('id-number').value.trim();
            const msg = document.getElementById('firebase-msg');
            const spinner = document.getElementById('loading-spinner');

            if (!idNumber) {
                msg.innerHTML = "<span class='text-red-600'>Please enter Student ID.</span>";
                return;
            }

            spinner.classList.remove('hidden');
            msg.innerText = "Checking database...";

            try {
                const docRef = doc(db, "attendance", recordId);
                const docSnap = await getDoc(docRef);

                if (docSnap.exists()) {
                    const data = docSnap.data();
                    const studentsArray = data.students;

                    if (Array.isArray(studentsArray)) {
                        const student = studentsArray.find(s => String(s.Idnumber) === String(idNumber));

                        if (student) {
                            const status = student.status || "";
                            if (status.includes("‚úî") || status.includes("‚úì") || status.includes("‚úîÔ∏è")) {
                                const cn = student.CN || "";
                                const name = student.fullName || "";
                                const section = data.section || ""; 

                                // ---------------------------------------------------------
                                // ENHANCEMENT: DUPLICATE SUBMISSION CHECK
                                // ---------------------------------------------------------
                                const collectionName = `results_S2T1 Summative Test 01_${recordId}`;
                                const docName = `students.${cn}-students.${idNumber}-${name}`;
                                
                                // Check if a result file already exists for this student
                                msg.innerText = "Verifying previous attempts...";
                                const resultSnap = await getDoc(doc(db, collectionName, docName));
                                
                                if (resultSnap.exists()) {
                                     msg.innerHTML = `<span class='text-red-700 font-bold'>‚õî Access Denied: You have already taken this test. No retakes allowed.</span>`;
                                     spinner.classList.add('hidden');
                                     return; // STOP EXECUTION
                                }
                                // ---------------------------------------------------------
                                // END ENHANCEMENT
                                // ---------------------------------------------------------

                                document.getElementById('class-number').value = cn;
                                document.getElementById('full-name').value = name;
                                document.getElementById('grade-section').value = section;
                                
                                // Enable Start Button
                                const btn = document.getElementById('btn-start-exam');
                                btn.disabled = false;
                                btn.classList.remove('bg-gray-400', 'cursor-not-allowed');
                                btn.classList.add('bg-blue-800', 'hover:bg-blue-900', 'hover:scale-[1.02]');

                                msg.innerHTML = "<span class='text-green-600 font-bold'>‚úì Student Found & Verified!</span>";
                            } else {
                                msg.innerHTML = `<span class='text-red-600 font-bold'>‚ö† Student is marked absent (Status: ${status}). Login denied.</span>`;
                            }
                        } else {
                            msg.innerHTML = "<span class='text-red-600'>ID Number not found in this attendance record.</span>";
                        }
                    } else {
                         msg.innerHTML = "<span class='text-red-600'>Error: 'students' field is not an array.</span>";
                    }
                } else {
                    msg.innerHTML = "<span class='text-red-600'>Attendance Record not found (Invalid Link).</span>";
                }
            } catch (error) {
                console.error("Firebase Error:", error);
                msg.innerHTML = "<span class='text-red-600'>Connection Error. Please try again.</span>";
            } finally {
                spinner.classList.add('hidden');
            }
        };

        // Save to Firebase
        window.saveResultsToFirebase = async function(resultData) {
            const overlay = document.getElementById('submission-overlay');
            overlay.classList.remove('hidden');

            const attendanceId = document.getElementById('attendance-record').value;
            // Collection: results_S2T1 Summative Test 01_ATTENDANCE_ID
            const collectionName = `results_S2T1 Summative Test 01_${attendanceId}`;
            
            const docName = `students.${resultData.studentInfo.cn}-students.${resultData.studentInfo.idNumber}-${resultData.studentInfo.fn}`;

            try {
                // Sanitize data structure before saving
                // Ensure no undefined values exist in the object tree
                const cleanData = JSON.parse(JSON.stringify(resultData, (k, v) => v === undefined ? null : v));
                
                await setDoc(doc(db, collectionName, docName), cleanData);
                // This saves the Collection Name into the 'results_list' so the dashboard can see it
                await setDoc(doc(db, "results_list", collectionName), { 
                    created: new Date().toISOString() 
                            });
                return true;
            } catch (error) {
                console.error("Save Error", error);
                alert("Error saving to server: " + error.message);
                overlay.classList.add('hidden');
                return false;
            }
        };

    </script>

    <script>
        // --- DATA SOURCE ---
        // REVISED QUESTIONS: Abbreviations expanded, complete forms used.
        const allQuestionsPool = [
            { id: 1, type: 'Theory', topic: 'merchandising foundations', q: 'The primary activity of a merchandising business is to:', options: ['Perform services for fees.', 'Buy and sell goods for profit.', 'Manufacture raw materials into finished goods.', 'Invest in stocks and bonds.'], a: 'Buy and sell goods for profit.', s: 'Unlike service or manufacturing companies, merchandisers primarily purchase finished goods to resell them.' },
  { id: 2, type: 'Theory', topic: 'merchandising foundations', q: 'Which of the following best describes "Merchandise Inventory"?', options: ['Equipment used in the office.', 'Goods held for sale to customers.', 'Supplies used for cleaning.', 'Raw materials waiting to be processed.'], a: 'Goods held for sale to customers.', s: 'Merchandise inventory consists of goods owned by the company and held for the purpose of being sold to customers.' },
  { id: 3, type: 'Theory', topic: 'merchandising foundations', q: 'A merchandiser that sells goods directly to consumers is called a:', options: ['Wholesaler.', 'Manufacturer.', 'Retailer.', 'Broker.'], a: 'Retailer.', s: 'Retailers sell goods directly to the end-user (consumers), whereas wholesalers typically sell to retailers.' },
  { id: 4, type: 'Theory', topic: 'merchandising foundations', q: 'A merchandiser that buys goods in bulk from manufacturers and sells them to retailers is called a:', options: ['Wholesaler.', 'Service provider.', 'End consumer.', 'Retailer.'], a: 'Wholesaler.', s: 'Wholesalers act as intermediaries between manufacturers and retailers.' },
  { id: 5, type: 'Theory', topic: 'merchandising foundations', q: 'The operating cycle of a merchandising company is generally ________ than that of a service company.', options: ['Shorter', 'Longer', 'The same length', 'Non-existent'], a: 'Longer', s: 'It is longer because it involves purchasing inventory, holding it, selling it, and then collecting cash, rather than just performing a service and collecting cash.' },
  { id: 6, type: 'Theory', topic: 'merchandising foundations', q: 'In the merchandising operating cycle, what step follows the purchase of inventory?', options: ['Collecting cash from customers.', 'Selling the inventory.', 'Manufacturing the goods.', 'Hiring employees.'], a: 'Selling the inventory.', s: 'The cycle flows from Cash -> Purchase of Inventory -> Sale of Inventory -> Collection of Cash.' },
  { id: 7, type: 'Theory', topic: 'merchandising foundations', q: 'Which document establishes an initial internal record of the order placed with a supplier?', options: ['Sales Invoice.', 'Purchase Order.', 'Receiving Report.', 'Check Register.'], a: 'Purchase Order.', s: 'A Purchase Order (PO) is a document issued by the buyer to the seller indicating types, quantities, and agreed prices for products or services.' },
  { id: 8, type: 'Theory', topic: 'merchandising foundations', q: 'Internal control over inventory is important because inventory is:', options: ['A liability.', 'Not a significant asset.', 'Vulnerable to theft and damage.', 'Always kept in a bank vault.'], a: 'Vulnerable to theft and damage.', s: 'Inventory is a physical asset that must be safeguarded against shrinkage, theft, and deterioration.' },
  { id: 9, type: 'Theory', topic: 'merchandising foundations', q: 'Which department should be responsible for authorizing a purchase of inventory?', options: ['The Receiving Department.', 'The Purchasing Department.', 'The Accounting Department.', 'The Sales Department.'], a: 'The Purchasing Department.', s: 'Segregation of duties dictates that the Purchasing Department authorizes the order, distinct from receiving or accounting.' },
  { id: 10, type: 'Theory', topic: 'merchandising foundations', q: 'A document used to record the quantity and condition of goods arriving at the business is called a:', options: ['Purchase Order.', 'Invoice.', 'Receiving Report.', 'Requisition Form.'], a: 'Receiving Report.', s: 'The receiving report verifies that goods were actually received and notes their condition before payment is approved.' },
  { id: 11, type: 'Theory', topic: 'merchandising foundations', q: 'The "Three-Way Match" control procedure involves comparing which three documents?', options: ['Purchase Requisition, Check, and Bank Statement.', 'Purchase Order, Receiving Report, and Vendor Invoice.', 'Sales Slip, Deposit Slip, and Ledger.', 'Inventory Count, Sales Journal, and Balance Sheet.'], a: 'Purchase Order, Receiving Report, and Vendor Invoice.', s: 'This ensures the company pays only for goods that were ordered (PO) and actually received (Receiving Report) at the correct price (Invoice).' },
  { id: 12, type: 'Theory', topic: 'merchandising foundations', q: 'Separation of duties in a merchandising firm helps prevent:', options: ['Profit generation.', 'Errors and fraud.', 'Efficient operations.', 'Customer satisfaction.'], a: 'Errors and fraud.', s: 'By dividing responsibilities (e.g., authorization, custody, recording), it becomes much harder for a single employee to commit and conceal fraud.' },
  { id: 13, type: 'Theory', topic: 'merchandising foundations', q: 'Who should physically count the inventory when it arrives?', options: ['The person who ordered the goods.', 'The person who writes the check for payment.', 'Personnel in the receiving department.', 'The accounts payable clerk.'], a: 'Personnel in the receiving department.', s: 'Receiving personnel should count goods to ensure independence from purchasing and accounting functions.' },
  { id: 14, type: 'Theory', topic: 'merchandising foundations', q: 'A bill received from a seller requesting payment for goods is known as a(n):', options: ['Purchase Order.', 'Receiving Report.', 'Purchase Requisition.', 'Invoice.'], a: 'Invoice.', s: 'The invoice is the seller\'s request for payment and identifies the items sold and the amount due.' },
  { id: 15, type: 'Theory', topic: 'merchandising foundations', q: 'Which of the following is NOT a characteristic of a service business?', options: ['Revenue is generated by providing skills or time.', 'No physical inventory is held for resale.', 'Operating cycle is usually shorter.', 'Revenue is generated by selling tangible goods.'], a: 'Revenue is generated by selling tangible goods.', s: 'Selling tangible goods is the defining characteristic of a merchandising business, not a service business.' },
  { id: 16, type: 'Theory', topic: 'merchandising foundations', q: 'Physical controls to safeguard inventory include:', options: ['Security cameras and locked warehouses.', 'Double-entry accounting.', 'Hiring more accountants.', 'Writing more checks.'], a: 'Security cameras and locked warehouses.', s: 'Physical controls restrict access to assets to prevent theft or unauthorized use.' },
  { id: 17, type: 'Theory', topic: 'merchandising foundations', q: 'When a discrepancy exists between the Purchase Order and the Receiving Report, the accounting department should:', options: ['Immediately pay the invoice.', 'Investigate the difference before payment.', 'Change the Purchase Order to match.', 'Ignore the difference.'], a: 'Investigate the difference before payment.', s: 'Discrepancies must be resolved to ensure the company only pays for what it ordered and received.' },
  { id: 18, type: 'Theory', topic: 'merchandising foundations', q: 'The person who signs checks for payment should not be the same person who:', options: ['Authorizes purchases.', 'Greets customers.', 'Manages the parking lot.', 'Files tax returns.'], a: 'Authorizes purchases.', s: 'Separating the authorization of a transaction (purchasing) from the custody of assets (signing checks/cash) prevents fraud.' },
  { id: 19, type: 'Theory', topic: 'merchandising foundations', q: 'A "Blind Count" in receiving refers to:', options: ['Counting goods in the dark.', 'Receiving personnel counting goods without seeing the quantity ordered on the PO.', 'Guessing the number of items.', 'Accepting goods without looking at them.'], a: 'Receiving personnel counting goods without seeing the quantity ordered on the PO.', s: 'This forces the receiving clerk to actually count the items rather than just copying the number from the order form.' },
  { id: 20, type: 'Theory', topic: 'merchandising foundations', q: 'Which of the following is considered an internal control weakness?', options: ['One employee orders inventory and also approves the payment.', 'Pre-numbered documents are used.', 'Unused checks are stored in a locked safe.', 'Inventory is counted annually.'], a: 'One employee orders inventory and also approves the payment.', s: 'This lacks segregation of duties, allowing an employee to potentially order personal items and pay for them with company funds.' },
  { id: 21, type: 'Theory', topic: 'merchandising foundations', q: 'The document that acts as an internal request for the Purchasing Department to buy items is a:', options: ['Purchase Order.', 'Purchase Requisition.', 'Invoice.', 'Sales Slip.'], a: 'Purchase Requisition.', s: 'A requisition is an internal document triggering the purchasing process, usually sent by a department manager to the purchasing agent.' },
  { id: 22, type: 'Theory', topic: 'merchandising foundations', q: 'In a merchandising business, "Cost of Goods Sold" represents:', options: ['The total revenue from sales.', 'The cost of buying the inventory that was sold.', 'The cost of electricity and rent.', 'The salary of the salespeople.'], a: 'The cost of buying the inventory that was sold.', s: 'Cost of Goods Sold (COGS) is the primary expense for a merchandiser, representing the cost of the inventory sold to generate revenue.' },
  { id: 23, type: 'Theory', topic: 'merchandising foundations', q: 'Gross Profit is defined as:', options: ['Net Income minus Expenses.', 'Sales Revenue minus Operating Expenses.', 'Sales Revenue minus Cost of Goods Sold.', 'Assets minus Liabilities.'], a: 'Sales Revenue minus Cost of Goods Sold.', s: 'Gross profit is the preliminary profit calculated by deducting the cost of the product from the sales revenue.' },
  { id: 24, type: 'Theory', topic: 'merchandising foundations', q: 'Which of the following implies that a company is a merchandising business?', options: ['Inventory Account.', 'Service Revenue Account.', 'Consulting Fees Earned.', 'Medical Supplies Expense (consumed).'], a: 'Inventory Account.', s: 'The presence of an Inventory account (asset) clearly indicates the business buys and holds goods for resale.' },
  { id: 25, type: 'Theory', topic: 'merchandising foundations', q: 'Using pre-numbered purchase orders helps in:', options: ['Ensuring all orders are accounted for and none are missing.', 'Making the forms look professional.', 'Increasing the cost of supplies.', 'Making the filing system larger.'], a: 'Ensuring all orders are accounted for and none are missing.', s: 'Pre-numbering is a control procedure that helps identify missing documents or unauthorized transactions.' },
  { id: 26, type: 'Theory', topic: 'merchandising foundations', q: 'For good internal control, the Accounting Department should record the purchase only when:', options: ['The supplier calls to ask for money.', 'The purchase order is sent.', 'The Three-Way Match is complete and verified.', 'The goods are requested.'], a: 'The Three-Way Match is complete and verified.', s: 'Recording a liability (Accounts Payable) should only happen when there is evidence (PO, Receiving Report, Invoice) that a valid obligation exists.' },
  { id: 27, type: 'Theory', topic: 'merchandising foundations', q: 'Why should the receiving department not have access to the prices on the purchase order?', options: ['To save ink.', 'To prevent them from stealing the goods.', 'To ensure they focus on quantity and quality, not value.', 'To keep the suppliers secret.'], a: 'To ensure they focus on quantity and quality, not value.', s: 'While sometimes they do see prices, often the focus is on accurate counts; however, hiding quantity (blind count) is the more common control.' },
  { id: 28, type: 'Theory', topic: 'merchandising foundations', q: 'In a retail business, the cash register tape serves as a source document for:', options: ['Purchases.', 'Sales transactions.', 'Payroll.', 'Utility payments.'], a: 'Sales transactions.', s: 'The register tape provides objective evidence of cash sales occurring during the day.' },
  { id: 29, type: 'Theory', topic: 'merchandising foundations', q: 'Which of the following is an example of a merchandising business?', options: ['A law firm.', 'A grocery store.', 'A dental clinic.', 'An accounting firm.'], a: 'A grocery store.', s: 'A grocery store buys food products and resells them to customers, fitting the definition of a merchandiser.' },
  { id: 30, type: 'Theory', topic: 'merchandising foundations', q: 'Operating expenses for a merchandiser include:', options: ['Cost of Goods Sold.', 'Selling and Administrative expenses.', 'The cost of the product.', 'The purchase price of inventory.'], a: 'Selling and Administrative expenses.', s: 'Operating expenses are costs incurred to run the business (like rent, salaries, advertising) distinct from the Cost of Goods Sold.' },
  { id: 31, type: 'Theory', topic: 'merchandising foundations', q: 'Which employee should be responsible for mailing the check to the supplier?', options: ['The employee who ordered the goods.', 'The employee who received the goods.', 'An employee in the Treasurer\'s office.', 'The accountant who recorded the payable.'], a: 'An employee in the Treasurer\'s office.', s: 'The Treasurer (custody of assets) handles the actual cash/check, distinct from the Controller/Accountant (record keeping).' },
  { id: 32, type: 'Theory', topic: 'merchandising foundations', q: 'Internal controls regarding sales usually require that cashiers:', options: ['Have access to the accounting records.', 'Count their own drawer without supervision.', 'Are responsible for the cash drawer they are assigned to.', 'Share a single cash drawer with all other employees.'], a: 'Are responsible for the cash drawer they are assigned to.', s: 'Assigning responsibility to a specific individual allows for accountability if cash is missing.' },
  { id: 33, type: 'Theory', topic: 'merchandising foundations', q: 'When goods are sold on credit, the seller usually issues a:', options: ['Receiving Report.', 'Sales Invoice.', 'Purchase Order.', 'Check.'], a: 'Sales Invoice.', s: 'The sales invoice informs the customer of the amount owed and the payment terms.' },
  { id: 34, type: 'Theory', topic: 'merchandising foundations', q: 'The conversion of inventory into cash is the final step of the operating cycle for:', options: ['Cash sales.', 'Credit sales (after collection).', 'Service revenue.', 'Prepaid expenses.'], a: 'Cash sales.', s: 'If a sale is for cash, the cycle ends immediately. If on credit, the cycle ends when the Accounts Receivable is collected.' },
  { id: 35, type: 'Theory', topic: 'merchandising foundations', q: 'A "Voucher System" is a set of procedures for controlling:', options: ['Cash receipts.', 'Cash payments.', 'Inventory storage.', 'Sales personnel.'], a: 'Cash payments.', s: 'A voucher system is a network of approvals, by different people, to ensure that all disbursements by check are proper.' },
  { id: 36, type: 'Theory', topic: 'merchandising foundations', q: 'Requiring daily deposits of cash receipts is a control to:', options: ['Minimize the amount of cash on hand susceptible to theft.', 'Increase the interest earned.', 'Make the bank happy.', 'Reduce the work of the cashier.'], a: 'Minimize the amount of cash on hand susceptible to theft.', s: 'Keeping large amounts of cash on premises increases risk; daily deposits mitigate this.' },
  { id: 37, type: 'Theory', topic: 'merchandising foundations', q: 'Who is the "Vendor" in a purchasing transaction?', options: ['The buyer.', 'The seller or supplier.', 'The delivery truck driver.', 'The government.'], a: 'The seller or supplier.', s: 'The vendor is the external party from whom the merchandising business purchases its inventory.' },
  { id: 38, type: 'Theory', topic: 'merchandising foundations', q: 'The term "on account" implies:', options: ['Immediate cash payment.', 'Credit has been extended (payment to be made later).', 'A discount was given.', 'The goods were returned.'], a: 'Credit has been extended (payment to be made later).', s: 'Buying or selling "on account" means the transaction is on credit, creating an Account Receivable or Account Payable.' },
  { id: 39, type: 'Theory', topic: 'merchandising foundations', q: 'To prevent "phantom vendors" (fraud), a company should maintain:', options: ['An approved vendor list.', 'A large supply of checks.', 'Multiple bank accounts.', 'Open internet access.'], a: 'An approved vendor list.', s: 'Limiting purchases to vetted, approved vendors prevents employees from creating fake companies to pay themselves.' },
  { id: 40, type: 'Theory', topic: 'merchandising foundations', q: 'Which is a correct flow of documents in purchasing?', options: ['Invoice -> PO -> Requisition.', 'Requisition -> PO -> Receiving Report -> Invoice.', 'Receiving Report -> Requisition -> PO.', 'PO -> Invoice -> Requisition.'], a: 'Requisition -> PO -> Receiving Report -> Invoice.', s: 'First the need is identified (Requisition), then ordered (PO), then received (Report), and finally billed (Invoice).' },
  { id: 41, type: 'Theory', topic: 'merchandising foundations', q: 'Merchandise Inventory is classified on the Balance Sheet as a(n):', options: ['Current Liability.', 'Long-term Asset.', 'Current Asset.', 'Owner\'s Equity.'], a: 'Current Asset.', s: 'Inventory is a resource expected to be sold and converted to cash within the operating cycle (usually one year).' },
  { id: 42, type: 'Theory', topic: 'merchandising foundations', q: 'The main difference between the Income Statement of a service firm and a merchandiser is the inclusion of:', options: ['Rent Expense.', 'Salaries Expense.', 'Cost of Goods Sold and Gross Profit.', 'Net Income.'], a: 'Cost of Goods Sold and Gross Profit.', s: 'These line items are specific to companies that sell physical goods.' },
  { id: 43, type: 'Theory', topic: 'merchandising foundations', q: 'Safeguarding inventory involves not only physical protection but also:', options: ['Insurance coverage.', 'Hiring sales staff.', 'Printing catalogs.', 'Buying expensive furniture.'], a: 'Insurance coverage.', s: 'Insurance is a risk management tool that protects the financial value of the asset in case of fire or disaster.' },
  { id: 44, type: 'Theory', topic: 'merchandising foundations', q: 'Which statement is true regarding the ownership of goods?', options: ['Ownership always transfers when cash is paid.', 'Ownership transfers based on the terms of shipping (FOB terms).', 'The seller always owns the goods until they are consumed.', 'The buyer owns the goods as soon as they order them.'], a: 'Ownership transfers based on the terms of shipping (FOB terms).', s: 'Although freight calculations are excluded, the *definition* of ownership transfer relies on legal title passing, usually defined by FOB points.' },
  { id: 45, type: 'Theory', topic: 'merchandising foundations', q: 'If a company sells an item for $100 that cost $60 to buy, the $40 difference is called:', options: ['Net Income.', 'Operating Expense.', 'Gross Profit.', 'Total Asset.'], a: 'Gross Profit.', s: 'Sales Price ($100) - Cost of Goods Sold ($60) = Gross Profit ($40).' },
  { id: 46, type: 'Theory', topic: 'merchandising foundations', q: 'Bonding employees who handle cash means:', options: ['Taking them to lunch.', 'Insuring the company against theft by those employees.', 'Forcing them to work together.', 'Checking their background only once.'], a: 'Insuring the company against theft by those employees.', s: 'Bonding is an insurance policy that reimburses the employer for losses caused by employee theft.' },
  { id: 47, type: 'Theory', topic: 'merchandising foundations', q: 'A physical inventory count is required:', options: ['Only in periodic systems.', 'Only in perpetual systems.', 'In both systems to verify records.', 'Never.'], a: 'In both systems to verify records.', s: 'Regardless of the system used, a physical count (taking inventory) is a necessary control to verify the actual quantity on hand.' },
  { id: 48, type: 'Theory', topic: 'merchandising foundations', q: 'Which of the following is an administrative expense rather than a selling expense?', options: ['Sales commissions.', 'Advertising costs.', 'Office salaries.', 'Delivery costs to customers.'], a: 'Office salaries.', s: 'Administrative expenses relate to general management, whereas selling expenses relate directly to marketing and distributing the product.' },
  { id: 49, type: 'Theory', topic: 'merchandising foundations', q: 'Rotation of duties (mandatory vacations) is a control procedure designed to:', options: ['Improve employee morale.', 'Prevent fraud by ensuring one person does not permanently control a process.', 'Reduce salary costs.', 'Train employees in all areas.'], a: 'Prevent fraud by ensuring one person does not permanently control a process.', s: 'If an employee is committing fraud, they often refuse to take leave to prevent others from discovering their irregularities.' },
  { id: 50, type: 'Theory', topic: 'merchandising foundations', q: 'The "Operating Cycle" refers to the time it takes to:', options: ['Open the store in the morning.', 'Go from cash to inventory to receivables and back to cash.', 'Pay all debts.', 'Complete one year of business.'], a: 'Go from cash to inventory to receivables and back to cash.', s: 'It is the average time required to purchase inventory, sell it on account, and then collect cash from customers.' },
  { id: 51, type: 'Theory', topic: 'fifo periodic theory', q: 'The acronym FIFO stands for:', options: ['First-In, First-Out.', 'First-In, First-Over.', 'Final-In, First-Out.', 'Fixed-In, Fixed-Out.'], a: 'First-In, First-Out.', s: 'FIFO implies that the first goods purchased are assumed to be the first goods sold.' },
  { id: 52, type: 'Theory', topic: 'fifo periodic theory', q: 'Under the FIFO method, the costs assigned to the ending inventory are taken from:', options: ['The earliest purchases of the period.', 'The most recent purchases of the period.', 'An average of all purchases.', 'The beginning inventory only.'], a: 'The most recent purchases of the period.', s: 'Since the oldest goods are sold first, the goods remaining on hand (ending inventory) are assumed to be from the latest purchases.' },
  { id: 53, type: 'Theory', topic: 'fifo periodic theory', q: 'Which costs are assigned to Cost of Goods Sold (COGS) under FIFO?', options: ['The costs of the most recent purchases.', 'The average cost of all goods available.', 'The costs of the earliest goods purchased.', 'The current replacement cost.'], a: 'The costs of the earliest goods purchased.', s: 'FIFO assumes that the oldest inventory items are sold first, so their costs are transferred to COGS.' },
  { id: 54, type: 'Theory', topic: 'fifo periodic theory', q: 'In a periodic system using FIFO, how is the Cost of Goods Sold determined?', options: ['By calculating it after every sale.', 'By subtracting the Ending Inventory cost from the Cost of Goods Available for Sale.', 'By averaging the beginning and ending inventory.', 'It is not calculated in a periodic system.'], a: 'By subtracting the Ending Inventory cost from the Cost of Goods Available for Sale.', s: 'In a periodic system, COGS is a residual amount calculated at the end of the period: (Beginning Inventory + Purchases) - Ending Inventory.' },
  { id: 55, type: 'Theory', topic: 'fifo periodic theory', q: 'Which of the following is a primary advantage of the FIFO method regarding the Balance Sheet?', options: ['It matches current costs with current revenues.', 'It results in the lowest net income.', 'It reports ending inventory at amounts approximating current replacement costs.', 'It allows for income manipulation.'], a: 'It reports ending inventory at amounts approximating current replacement costs.', s: 'Because ending inventory is composed of the most recently purchased goods, the value on the balance sheet is close to the current market price.' },
  { id: 56, type: 'Theory', topic: 'fifo periodic theory', q: 'Does the physical flow of goods have to perfectly match the cost flow assumption in FIFO?', options: ['Yes, goods must be physically stored in lines.', 'No, cost flow assumptions can differ from the actual physical movement of goods.', 'Yes, otherwise it is illegal.', 'Only in a manufacturing business.'], a: 'No, cost flow assumptions can differ from the actual physical movement of goods.', s: 'FIFO is an assumption about how costs flow; the company might actually sell newer goods first physically, but for accounting, they expense the older costs first.' },
  { id: 57, type: 'Theory', topic: 'fifo periodic theory', q: 'In a period of rising prices (inflation), FIFO will result in:', options: ['Lower Net Income compared to LIFO.', 'Higher Cost of Goods Sold compared to LIFO.', 'Higher Net Income compared to LIFO.', 'Lower Ending Inventory value.'], a: 'Higher Net Income compared to LIFO.', s: 'Because older, cheaper costs are expensed as COGS while newer, expensive costs stay in inventory, profit appears higher.' },
  { id: 58, type: 'Theory', topic: 'fifo periodic theory', q: 'In a period of rising prices, the Ending Inventory under FIFO will be:', options: ['Lower than under LIFO.', 'Higher than under LIFO.', 'The same as Average Cost.', 'Zero.'], a: 'Higher than under LIFO.', s: 'The ending inventory consists of the most recent, higher-priced purchases, resulting in a higher inventory valuation.' },
  { id: 59, type: 'Theory', topic: 'fifo periodic theory', q: 'The "layers" of inventory that are peeled away first in FIFO are:', options: ['The newest layers.', 'The middle layers.', 'The oldest layers.', 'The random layers.'], a: 'The oldest layers.', s: 'FIFO removes the oldest cost layers (beginning inventory and early purchases) to calculate COGS.' },
  { id: 60, type: 'Theory', topic: 'fifo periodic theory', q: 'Under the periodic FIFO method, when is the cost of ending inventory computed?', options: ['After each sale.', 'At the end of the accounting period.', 'At the beginning of the period.', 'When the purchase order is sent.'], a: 'At the end of the accounting period.', s: 'In a periodic system, the inventory count and cost assignment occur only at the period\'s end.' },
  { id: 61, type: 'Theory', topic: 'fifo periodic theory', q: 'One criticism of FIFO is that:', options: ['It results in outdated inventory values on the Balance Sheet.', 'It matches old costs with current revenues, potentially distorting income.', 'It is too difficult to calculate.', 'It is not permitted by accounting standards.'], a: 'It matches old costs with current revenues, potentially distorting income.', s: 'By matching older (often lower) costs against current (often higher) sales prices, it can create "phantom profits" during inflation.' },
  { id: 62, type: 'Theory', topic: 'fifo periodic theory', q: 'If a company uses FIFO periodic, the "Goods Available for Sale" consists of:', options: ['Ending Inventory only.', 'Beginning Inventory + Net Purchases.', 'Net Sales - Cost of Goods Sold.', 'Purchases - Ending Inventory.'], a: 'Beginning Inventory + Net Purchases.', s: 'Goods Available for Sale is the total pool of goods that could potentially be sold during the period.' },
  { id: 63, type: 'Theory', topic: 'fifo periodic theory', q: 'To calculate the cost of Ending Inventory under FIFO Periodic, you start counting units from:', options: ['The beginning inventory forward.', 'The most recent purchase backward.', 'The middle of the year.', 'The earliest purchase.'], a: 'The most recent purchase backward.', s: 'You take the units on hand and assign costs starting from the latest invoice, then the next latest, until all units are costed.' },
  { id: 64, type: 'Theory', topic: 'fifo periodic theory', q: 'Which inventory cost flow assumption usually parallels the actual physical flow of merchandise?', options: ['LIFO', 'FIFO', 'Weighted Average', 'Specific Identification'], a: 'FIFO', s: 'Most businesses (like grocery stores) attempt to sell their oldest goods first to prevent spoilage, matching the FIFO assumption.' },
  { id: 65, type: 'Theory', topic: 'fifo periodic theory', q: 'In a period of falling prices (deflation), FIFO results in:', options: ['Higher Net Income.', 'Lower Net Income.', 'Higher Ending Inventory.', 'Lower Cost of Goods Sold.'], a: 'Lower Net Income.', s: 'In deflation, the oldest costs (expensed first) are higher than recent costs, resulting in higher COGS and lower Net Income.' },
  { id: 66, type: 'Theory', topic: 'fifo periodic theory', q: 'Does the Ending Inventory amount differ between FIFO Periodic and FIFO Perpetual systems?', options: ['Yes, Perpetual is always higher.', 'No, they result in the same amount.', 'Yes, Periodic is always higher.', 'It depends on the industry.'], a: 'No, they result in the same amount.', s: 'This is a unique property of FIFO; whether you calculate cost at the moment of sale or at the end of the month, the "first" goods are always the same.' },
  { id: 67, type: 'Theory', topic: 'fifo periodic theory', q: 'If the Ending Inventory count is overstated in a FIFO periodic system, what happens to COGS?', options: ['COGS will be overstated.', 'COGS will be understated.', 'COGS will be unaffected.', 'Sales will be understated.'], a: 'COGS will be understated.', s: 'Since COGS = Goods Available - Ending Inventory, a higher (overstated) deduction for EI results in a lower (understated) COGS.' },
  { id: 68, type: 'Theory', topic: 'fifo periodic theory', q: 'The term "Inventory Profit" or "Phantom Profit" refers to:', options: ['Profit earned from selling inventory illegally.', 'Higher income reported due to matching old, low costs with new, high prices.', 'Profit made from cash discounts.', 'Profit hidden from the tax authorities.'], a: 'Higher income reported due to matching old, low costs with new, high prices.', s: 'This occurs in FIFO during inflation, where the paper profit is high but the cash needed to replace the inventory is also high.' },
  { id: 69, type: 'Theory', topic: 'fifo periodic theory', q: 'For tax purposes in an inflationary environment, a company using FIFO would generally pay:', options: ['Lower taxes.', 'Higher taxes.', 'No taxes.', 'The same taxes as LIFO.'], a: 'Higher taxes.', s: 'Since FIFO reports higher Net Income during inflation, the taxable income is higher.' },
  { id: 70, type: 'Theory', topic: 'fifo periodic theory', q: 'What is the first step in determining the cost of ending inventory in a periodic FIFO system?', options: ['Calculate the Cost of Goods Sold.', 'Perform a physical count of the inventory.', 'Determine the sales price.', 'Close the books.'], a: 'Perform a physical count of the inventory.', s: 'In a periodic system, you must first know how many units are physically on hand before you can assign costs to them.' },
  { id: 71, type: 'Theory', topic: 'fifo periodic theory', q: 'If the Beginning Inventory is zero, and all purchases during the year are at the same unit cost, FIFO COGS will be:', options: ['Higher than Average Cost.', 'Lower than Average Cost.', 'The same as Average Cost and LIFO.', 'Impossible to determine.'], a: 'The same as Average Cost and LIFO.', s: 'Cost flow assumptions only produce different results when unit costs change (fluctuate) during the period.' },
  { id: 72, type: 'Theory', topic: 'fifo periodic theory', q: 'Which cost is "peeled off" last when calculating COGS in FIFO?', options: ['The earliest cost.', 'The most recent cost.', 'The beginning inventory cost.', 'The oldest purchase.'], a: 'The most recent cost.', s: 'The most recent costs remain in Ending Inventory; they would only be moved to COGS if the company sold everything it bought.' },
  { id: 73, type: 'Theory', topic: 'fifo periodic theory', q: 'The Consistency Principle dictates that:', options: ['A company should use FIFO for all products.', 'A company should use the same inventory method from year to year.', 'A company must use the same method as its competitors.', 'A company must change methods every year.'], a: 'A company should use the same inventory method from year to year.', s: 'While a company can choose FIFO, Consistency requires them to stick with it to make financial statements comparable over time.' },
  { id: 74, type: 'Theory', topic: 'fifo periodic theory', q: 'In FIFO, the "Cost of Goods Available for Sale" is split between:', options: ['Cash and Accounts Receivable.', 'Assets and Liabilities.', 'Cost of Goods Sold and Ending Inventory.', 'Sales and Expenses.'], a: 'Cost of Goods Sold and Ending Inventory.', s: 'The total pool of costs (GAFS) is allocated either to what was sold (COGS) or what remains (EI).' },
  { id: 75, type: 'Theory', topic: 'fifo periodic theory', q: 'Which of the following is NOT required to calculate FIFO Periodic ending inventory?', options: ['The quantity of goods on hand.', 'The unit costs of the most recent purchases.', 'The unit costs of the beginning inventory.', 'The sales price of the goods sold.'], a: 'The sales price of the goods sold.', s: 'Costing inventory strictly involves the acquisition costs (unit cost); the sales price is irrelevant to the cost valuation.' },
  { id: 76, type: 'Theory', topic: 'weighted average periodic theory', q: 'The primary objective of the weighted average cost method is to:', options: ['Match the oldest costs with revenue.', 'Match the newest costs with revenue.', 'Assign an average cost to both units sold and units on hand.', 'Track the specific cost of every individual item.'], a: 'Assign an average cost to both units sold and units on hand.', s: 'This method spreads the total cost of goods available for sale equally across all units.' },
  { id: 77, type: 'Theory', topic: 'weighted average periodic theory', q: 'In a periodic weighted average system, the weighted average unit cost is calculated:', options: ['After every purchase.', 'After every sale.', 'At the end of the accounting period.', 'At the beginning of the year.'], a: 'At the end of the accounting period.', s: 'Because it is a periodic system, the calculation is performed once at the end using total goods available.' },
  { id: 78, type: 'Theory', topic: 'weighted average periodic theory', q: 'The formula to calculate the weighted average unit cost is:', options: ['(Cost of Beginning Inventory + Cost of Purchases) / 2', 'Total Cost of Goods Available for Sale / Total Units Available for Sale', 'Total Sales / Total Units Sold', 'Cost of Purchases / Number of Purchases'], a: 'Total Cost of Goods Available for Sale / Total Units Available for Sale', s: 'This formula determines the average cost per unit for the entire pool of inventory.' },
  { id: 79, type: 'Theory', topic: 'weighted average periodic theory', q: 'Under the weighted average method, the cost assigned to the Ending Inventory is:', options: ['Based on the earliest costs.', 'Based on the most recent costs.', 'Based on the weighted average unit cost.', 'Based on the replacement cost.'], a: 'Based on the weighted average unit cost.', s: 'The calculated average unit cost is multiplied by the number of units remaining to value the ending inventory.' },
  { id: 80, type: 'Theory', topic: 'weighted average periodic theory', q: 'Compared to FIFO and LIFO, the weighted average method tends to:', options: ['Maximize net income.', 'Minimize net income.', 'Smooth out price fluctuations.', 'Ignore inflation.'], a: 'Smooth out price fluctuations.', s: 'By averaging costs, the peaks and valleys of price changes are leveled out, resulting in figures between FIFO and LIFO.' },
  { id: 81, type: 'Theory', topic: 'weighted average periodic theory', q: 'In a period of rising prices (inflation), the Net Income under Weighted Average will generally be:', options: ['Higher than FIFO.', 'Lower than LIFO.', 'Between FIFO and LIFO.', 'Zero.'], a: 'Between FIFO and LIFO.', s: 'Because the average cost includes both older (cheaper) and newer (expensive) units, the resulting profit falls between the extremes of FIFO and LIFO.' },
  { id: 82, type: 'Theory', topic: 'weighted average periodic theory', q: 'Which of the following is required to calculate the weighted average unit cost?', options: ['The exact date of every sale.', 'The specific identification of which units were sold.', 'The total cost and total quantity of goods available for sale.', 'The market value of the inventory.'], a: 'The total cost and total quantity of goods available for sale.', s: 'The calculation relies on the totals of the inventory pool, not on specific sales dates or physical flow.' },
  { id: 83, type: 'Theory', topic: 'weighted average periodic theory', q: 'Under the weighted average periodic method, the Cost of Goods Sold is calculated by:', options: ['Subtracting Ending Inventory form Goods Available for Sale.', 'Multiplying units sold by the most recent purchase price.', 'Multiplying units sold by the earliest purchase price.', 'Summing the specific costs of items sold.'], a: 'Subtracting Ending Inventory form Goods Available for Sale.', s: 'Once the Ending Inventory is valued using the average rate, it is subtracted from the total available cost to find COGS.' },
  { id: 84, type: 'Theory', topic: 'weighted average periodic theory', q: 'Does the weighted average method track the physical flow of goods?', options: ['Yes, it assumes the newest goods are sold first.', 'Yes, it assumes the oldest goods are sold first.', 'No, it assumes all units are identical and commingled.', 'Yes, it tracks specific serial numbers.'], a: 'No, it assumes all units are identical and commingled.', s: 'It assumes that units are interchangeable and assigns the same cost to every unit regardless of when it was bought.' },
  { id: 85, type: 'Theory', topic: 'weighted average periodic theory', q: 'If a company buys units at different prices throughout the month, the weighted average unit cost will fall:', options: ['Below the lowest purchase price.', 'Above the highest purchase price.', 'Somewhere between the lowest and highest purchase prices.', 'Exactly at the middle price.'], a: 'Somewhere between the lowest and highest purchase prices.', s: 'The average must mathematically exist within the range of the lowest and highest costs incurred.' },
  { id: 86, type: 'Theory', topic: 'weighted average periodic theory', q: 'When calculating the "Total Units Available for Sale" for the denominator, you include:', options: ['Only units purchased during the period.', 'Only units in beginning inventory.', 'Units in beginning inventory plus units purchased.', 'Units sold plus units returned.'], a: 'Units in beginning inventory plus units purchased.', s: 'The "pool" of inventory includes what you started with plus everything you added during the period.' },
  { id: 87, type: 'Theory', topic: 'weighted average periodic theory', q: 'If a company has zero beginning inventory and purchases all goods at the exact same price during the period, the weighted average cost will be:', options: ['Different from FIFO.', 'Different from LIFO.', 'The same as the unit purchase price.', 'Impossible to calculate.'], a: 'The same as the unit purchase price.', s: 'If there is no variation in price, the average is simply that single price.' },
  { id: 88, type: 'Theory', topic: 'weighted average periodic theory', q: 'The weighted average method is often used for inventory items that are:', options: ['Unique and high-value (like cars).', 'Perishable (like milk).', 'Similar in nature and intermingled (like gasoline or grain).', 'Custom-made.'], a: 'Similar in nature and intermingled (like gasoline or grain).', s: 'It is ideal for fungible goods where one unit is physically indistinguishable from another.' },
  { id: 89, type: 'Theory', topic: 'weighted average periodic theory', q: 'In the formula for weighted average cost, the numerator is:', options: ['Cost of Goods Sold.', 'Gross Profit.', 'Cost of Goods Available for Sale.', 'Ending Inventory Cost.'], a: 'Cost of Goods Available for Sale.', s: 'The numerator represents the total value of the inventory pool before any sales are accounted for.' },
  { id: 90, type: 'Theory', topic: 'weighted average periodic theory', q: 'Using weighted average periodic, if purchase prices are fluctuating wildly, the unit cost assigned to ending inventory will:', options: ['Represent the extreme high prices.', 'Represent the extreme low prices.', 'Reflect a blend of all prices paid.', 'Be based solely on the last price.'], a: 'Reflect a blend of all prices paid.', s: 'The method dampens the effect of extreme price swings by averaging them out.' },
  { id: 91, type: 'Theory', topic: 'weighted average periodic theory', q: 'Which statement is true regarding the unit cost used for COGS and Ending Inventory in this method?', options: ['They are different rates.', 'They are the same weighted average rate.', 'COGS uses the old rate; Inventory uses the new rate.', 'Inventory uses the old rate; COGS uses the new rate.'], a: 'They are the same weighted average rate.', s: 'The single average rate calculated is applied to both the units sold and the units remaining.' },
  { id: 92, type: 'Theory', topic: 'weighted average periodic theory', q: 'To find the Cost of Ending Inventory, you multiply the number of units on hand by:', options: ['The FIFO cost.', 'The weighted average unit cost.', 'The LIFO cost.', 'The selling price.'], a: 'The weighted average unit cost.', s: 'Value = Quantity x Rate (where Rate is the calculated weighted average).' },
  { id: 93, type: 'Theory', topic: 'weighted average periodic theory', q: 'A disadvantage of the weighted average method is:', options: ['It allows for income manipulation.', 'It is the most complex to calculate.', 'It does not match the most current costs with current revenue.', 'It cannot be used for taxes.'], a: 'It does not match the most current costs with current revenue.', s: 'Unlike LIFO (which matches current costs) or FIFO (which approximates current inventory value), Average settles in the middle, providing neither perfect matching nor current valuation.' },
  { id: 94, type: 'Theory', topic: 'weighted average periodic theory', q: 'In a periodic system, "moving average" is different from "weighted average" because:', options: ['Moving average is calculated after every purchase (perpetual).', 'Weighted average is calculated after every purchase.', 'There is no difference.', 'Moving average is illegal.'], a: 'Moving average is calculated after every purchase (perpetual).', s: 'Weighted average (periodic) is calculated once at the end; Moving average (perpetual) re-calculates the cost every time new stock arrives.' },
  { id: 95, type: 'Theory', topic: 'weighted average periodic theory', q: 'The "weights" in the weighted average calculation refer to:', options: ['The physical weight of the products (kg/lbs).', 'The quantity of units at each specific price point.', 'The importance of the supplier.', 'The shipping costs.'], a: 'The quantity of units at each specific price point.', s: 'A price paid for 1,000 units has more "weight" (influence) on the average than a price paid for only 10 units.' },
  { id: 96, type: 'Theory', topic: 'weighted average periodic theory', q: 'If the quantity of goods purchased changes but the price remains constant, the weighted average unit cost:', options: ['Increases.', 'Decreases.', 'Remains constant.', 'Cannot be determined.'], a: 'Remains constant.', s: 'The average cost only changes if the cost per unit changes; volume alone at the same price doesn\'t shift the average.' },
  { id: 97, type: 'Theory', topic: 'weighted average periodic theory', q: 'Cost of Goods Available for Sale equals:', options: ['Beginning Inventory Cost + Purchase Cost.', 'Sales - Expenses.', 'Ending Inventory - Purchases.', 'Beginning Inventory Cost - Purchase Cost.'], a: 'Beginning Inventory Cost + Purchase Cost.', s: 'This is the total value of the inventory pool available to be sold.' },
  { id: 98, type: 'Theory', topic: 'weighted average periodic theory', q: 'Under weighted average periodic, if you sell more units than you purchased this period:', options: ['You must have dipped into beginning inventory.', 'The calculation is impossible.', 'The unit cost will change.', 'You made a loss.'], a: 'You must have dipped into beginning inventory.', s: 'Sales exceeding purchases implies that stock carried over from the previous period (Beginning Inventory) was sold.' },
  { id: 99, type: 'Theory', topic: 'weighted average periodic theory', q: 'The weighted average method assumes that units in beginning inventory:', options: ['Are sold first.', 'Are sold last.', 'Are mixed with current purchases.', 'Are returned to the supplier.'], a: 'Are mixed with current purchases.', s: 'Beginning inventory is treated just like another purchase batch, rolled into the total average.' },
  { id: 100, type: 'Theory', topic: 'weighted average periodic theory', q: 'The final step in the weighted average periodic process is to:', options: ['Calculate the unit cost.', 'Count the inventory.', 'Apply the unit cost to the units sold and units on hand.', 'Post to the ledger.'], a: 'Apply the unit cost to the units sold and units on hand.', s: 'After determining the rate, you apply it to the quantities to derive the final dollar values for the financial statements.' },
  { id: 101, type: 'Theory', topic: 'fifo perpetual theory', q: 'In a perpetual inventory system using FIFO, the Cost of Goods Sold is recorded:', options: ['At the end of the month.', 'At the end of the year.', 'At the time of each sale.', 'When the next purchase is made.'], a: 'At the time of each sale.', s: 'The defining characteristic of a perpetual system is that inventory records and COGS are updated continuously with every transaction.' },
  { id: 102, type: 'Theory', topic: 'fifo perpetual theory', q: 'Under FIFO perpetual, if a sale occurs, which unit costs are removed from the inventory record first?', options: ['The costs of the most recently purchased units.', 'The costs of the earliest units purchased that are still on hand.', 'The average cost of all units.', 'The highest cost units.'], a: 'The costs of the earliest units purchased that are still on hand.', s: 'FIFO always assumes the "First In" (oldest) costs are the "First Out" (moved to COGS), regardless of when the calculation happens.' },
  { id: 103, type: 'Theory', topic: 'fifo perpetual theory', q: 'A key feature of the FIFO perpetual system regarding financial results is:', options: ['It yields a higher Net Income than FIFO periodic.', 'It yields a lower Ending Inventory than FIFO periodic.', 'It yields the same Ending Inventory and COGS as FIFO periodic.', 'It is impossible to compare with periodic.'], a: 'It yields the same Ending Inventory and COGS as FIFO periodic.', s: 'Because the "first" goods are always the same goods regardless of whether you calculate it daily or monthly, FIFO produces identical results under both systems.' },
  { id: 104, type: 'Theory', topic: 'fifo perpetual theory', q: 'The document or record used to track the individual inflows and outflows of inventory items in a perpetual system is called a:', options: ['General Ledger.', 'Stock card (or Subsidiary Ledger).', 'Check Register.', 'Purchase Requisition.'], a: 'Stock card (or Subsidiary Ledger).', s: 'A stock card tracks the specific quantity and cost of inventory for each item, showing the balance after every transaction.' },
  { id: 105, type: 'Theory', topic: 'fifo perpetual theory', q: 'In a FIFO perpetual record, the "Balance" column represents:', options: ['The cost of goods sold to date.', 'The inventory currently on hand.', 'The total purchases made.', 'The gross profit.'], a: 'The inventory currently on hand.', s: 'The balance column updates continuously to show what is legally owned by the company at that specific moment.' },
  { id: 106, type: 'Theory', topic: 'fifo perpetual theory', q: 'If a company uses FIFO perpetual, and prices are rising, the cost of goods sold recorded at the time of sale will reflect:', options: ['The older, lower costs.', 'The newer, higher costs.', 'The average costs.', 'The future replacement costs.'], a: 'The older, lower costs.', s: 'Since it is FIFO, the system grabs the oldest available cost layers, which in an inflationary period are the lower ones.' },
  { id: 107, type: 'Theory', topic: 'fifo perpetual theory', q: 'Unlike the periodic method, the perpetual FIFO method allows management to:', options: ['Know the inventory cost balance at any point in time.', 'Defer recording expenses until year-end.', 'Avoid paying taxes.', 'Ignore physical theft.'], a: 'Know the inventory cost balance at any point in time.', s: 'The continuous nature of the perpetual system provides real-time data for decision-making.' },
  { id: 108, type: 'Theory', topic: 'fifo perpetual theory', q: 'When a sale is made in a FIFO perpetual system, the "Cost" assigned to that sale comes from:', options: ['The last layer of inventory added.', 'The earliest layer of inventory available.', 'A weighted average of all layers.', 'The market price.'], a: 'The earliest layer of inventory available.', s: 'The system logically looks for the oldest date in the inventory records and uses that unit cost first.' },
  { id: 109, type: 'Theory', topic: 'fifo perpetual theory', q: 'Even in a perpetual FIFO system, a physical count is necessary to:', options: ['Calculate the Cost of Goods Sold.', 'Determine the Cost of Goods Available.', 'Verify the accuracy of the records and identify shrinkage.', 'Allocate overhead costs.'], a: 'Verify the accuracy of the records and identify shrinkage.', s: 'While the system tracks the *theoretical* balance, only a physical count can reveal if items were stolen, broken, or lost (shrinkage).' },
  { id: 110, type: 'Theory', topic: 'fifo perpetual theory', q: 'If a company returns goods to a supplier (Purchase Return) in a FIFO perpetual system, the cost removed from the inventory record is:', options: ['The specific cost of the units returned.', 'The oldest cost on record.', 'The newest cost on record.', 'The average cost.'], a: 'The specific cost of the units returned.', s: 'For returns, specific identification is usually necessary to remove the exact cost layer that was originally recorded for those units.' },
  { id: 111, type: 'Theory', topic: 'fifo perpetual theory', q: 'In the "Out" or "Sold" column of a FIFO stock card, the entries represent:', options: ['Increases in Inventory.', 'Decreases in Inventory (Cost of Goods Sold).', 'Returns from customers.', 'Purchases from vendors.'], a: 'Decreases in Inventory (Cost of Goods Sold).', s: 'The "Out" column records the cost of inventory leaving the company to be delivered to the customer.' },
  { id: 112, type: 'Theory', topic: 'fifo perpetual theory', q: 'Which of the following is NOT required to maintain a FIFO perpetual system?', options: ['Recording the date of every purchase.', 'Recording the date of every sale.', 'Waiting until the end of the month to calculate costs.', 'Keeping a running balance of unit costs.'], a: 'Waiting until the end of the month to calculate costs.', s: 'Waiting is a characteristic of the periodic system; perpetual requires immediate calculation.' },
  { id: 113, type: 'Theory', topic: 'fifo perpetual theory', q: 'Why might a company choose FIFO perpetual over Weighted Average perpetual?', options: ['It is easier to calculate manually.', 'It usually matches physical flow better and values ending inventory at current cost.', 'It smooths out price fluctuations.', 'It allows for lower tax payments in inflation.'], a: 'It usually matches physical flow better and values ending inventory at current cost.', s: 'FIFO is often preferred because it aligns with how goods physically move (oldest sold first) and keeps the balance sheet relevant.' },
  { id: 114, type: 'Theory', topic: 'fifo perpetual theory', q: 'If the earliest batch of inventory consisted of 100 units at $10, and 120 units are sold, the cost assigned to the sale under FIFO will include:', options: ['All 100 units at $10 plus 20 units from the next batch.', '120 units at $10.', '120 units from the newest batch.', 'An average cost of all batches.'], a: 'All 100 units at $10 plus 20 units from the next batch.', s: 'FIFO depletes the first layer completely (100 units) before dipping into the second layer for the remainder (20 units).' },
  { id: 115, type: 'Theory', topic: 'fifo perpetual theory', q: 'In a computerized FIFO perpetual system, who or what tracks the "layers" of inventory costs?', options: ['The warehouse manager.', 'The software database.', 'The customer.', 'The government.'], a: 'The software database.', s: 'Modern perpetual systems use software to automatically track the age and cost of every inventory layer.' },
  { id: 116, type: 'Theory', topic: 'fifo perpetual theory', q: 'When using FIFO perpetual, the ending inventory balance on the stock card represents:', options: ['The oldest costs incurred.', 'The most recent costs incurred.', 'The average of all costs.', 'The future costs.'], a: 'The most recent costs incurred.', s: 'Since the old costs were "sold" first, the costs remaining on the card must be the most recent ones.' },
  { id: 117, type: 'Theory', topic: 'fifo perpetual theory', q: 'Does the "Cost of Goods Sold" account increase or decrease when a sale is recorded in a FIFO perpetual system?', options: ['Decrease.', 'Increase.', 'No change.', 'It is credited.'], a: 'Increase.', s: 'Cost of Goods Sold is an expense account; it increases (is debited) when inventory is sold.' },
  { id: 118, type: 'Theory', topic: 'fifo perpetual theory', q: 'If an error is made in the beginning inventory balance in a FIFO perpetual system, it will affect:', options: ['Only the balance sheet.', 'Only the income statement.', 'Both the Cost of Goods Available and the running balance.', 'Nothing.'], a: 'Both the Cost of Goods Available and the running balance.', s: 'The beginning balance is the starting point; if it is wrong, the "Goods Available" and subsequent running balances will be incorrect.' },
  { id: 119, type: 'Theory', topic: 'fifo perpetual theory', q: 'The term "Inventory Layer" in FIFO refers to:', options: ['The physical shelf the goods sit on.', 'A specific quantity of goods purchased at a specific unit cost.', 'The packaging of the goods.', 'The hierarchy of employees.'], a: 'A specific quantity of goods purchased at a specific unit cost.', s: 'Each purchase at a different price creates a distinct "layer" of cost that must be tracked until sold.' },
  { id: 120, type: 'Theory', topic: 'fifo perpetual theory', q: 'In a FIFO perpetual system, "Phantom Profit" is caused by:', options: ['Selling inventory that does not exist.', 'The gap between the historical FIFO cost and the current replacement cost.', 'Computer errors.', 'Customer returns.'], a: 'The gap between the historical FIFO cost and the current replacement cost.', s: 'Because FIFO expenses old (cheap) costs against new (high) sales prices, profit looks high, but replacing the goods costs more.' },
  { id: 121, type: 'Theory', topic: 'fifo perpetual theory', q: 'Which statement is true regarding the flow of costs in FIFO Perpetual?', options: ['Costs flow sequentially (1st, 2nd, 3rd...).', 'Costs flow randomly.', 'Costs flow in reverse order.', 'Costs do not flow.'], a: 'Costs flow sequentially (1st, 2nd, 3rd...).', s: 'It follows a strict chronological sequence: the earliest date is processed first.' },
  { id: 122, type: 'Theory', topic: 'fifo perpetual theory', q: 'A "Stockout" occurs when:', options: ['The stock card balance drops to zero.', 'The warehouse is full.', 'Prices go down.', 'The accountant quits.'], a: 'The stock card balance drops to zero.', s: 'A stockout means there is no inventory available to sell, which is tracked immediately in a perpetual system.' },
  { id: 123, type: 'Theory', topic: 'fifo perpetual theory', q: 'Why is the FIFO perpetual system considered "balance sheet oriented"?', options: ['It ignores the income statement.', 'It results in the most accurate inventory valuation on the balance sheet.', 'It makes the balance sheet longer.', 'It is only used by banks.'], a: 'It results in the most accurate inventory valuation on the balance sheet.', s: 'By keeping the most recent costs in inventory, the asset value on the balance sheet closely reflects current market value.' },
  { id: 124, type: 'Theory', topic: 'fifo perpetual theory', q: 'If a purchase is made in the middle of the month, a FIFO perpetual system:', options: ['Adds a new cost layer immediately.', 'Waits until the end of the month to record it.', 'Averages it with existing stock immediately.', 'Ignores it.'], a: 'Adds a new cost layer immediately.', s: 'The system updates instantly, adding the new quantity and cost as a new layer available for future sales.' },
  { id: 125, type: 'Theory', topic: 'fifo perpetual theory', q: 'The validity of the FIFO assumption in a perpetual system depends on:', options: ['The actual physical flow of goods.', 'The method chosen by management for cost flow.', 'The tax laws only.', 'The computer operating system.'], a: 'The method chosen by management for cost flow.', s: 'FIFO is a cost flow assumption; it is valid simply because management selected it as their accounting policy, regardless of physical flow.' },
  { id: 126, type: 'Theory', topic: 'moving average perpetual theory', q: 'In a moving average perpetual inventory system, a new average unit cost is calculated:', options: ['At the end of the accounting period.', 'After every sale.', 'After every purchase.', 'At the beginning of the year.'], a: 'After every purchase.', s: 'The "moving" aspect refers to the re-calculation of the average cost immediately following the acquisition of new goods.' },
  { id: 127, type: 'Theory', topic: 'moving average perpetual theory', q: 'The formula for the new moving average unit cost is:', options: ['Total Cost of Goods Available / Total Units Available.', '(Total Cost of Inventory on Hand + Cost of New Purchase) / (Total Units on Hand + Units Purchased).', '(Old Unit Cost + New Unit Cost) / 2.', 'Cost of New Purchase / Units Purchased.'], a: '(Total Cost of Inventory on Hand + Cost of New Purchase) / (Total Units on Hand + Units Purchased).', s: 'This formula merges the existing inventory pool with the new batch to find a single weighted cost per unit.' },
  { id: 128, type: 'Theory', topic: 'moving average perpetual theory', q: 'Under the moving average perpetual system, the unit cost assigned to Cost of Goods Sold is:', options: ['The unit cost of the oldest goods.', 'The unit cost of the newest goods.', 'The moving average unit cost in effect at the time of the sale.', 'The average cost calculated at the end of the month.'], a: 'The moving average unit cost in effect at the time of the sale.', s: 'When a sale occurs, the system looks at the current average on the stock card and applies that rate to the units sold.' },
  { id: 129, type: 'Theory', topic: 'moving average perpetual theory', q: 'Does the moving average unit cost change when a sale is made?', options: ['Yes, it increases.', 'Yes, it decreases.', 'No, it remains the same.', 'It depends on the sales price.'], a: 'No, it remains the same.', s: 'Selling units reduces the total quantity and total cost proportionately, so the cost *per unit* of the remaining items stays constant.' },
  { id: 130, type: 'Theory', topic: 'moving average perpetual theory', q: 'The primary difference between "Weighted Average" (periodic) and "Moving Average" (perpetual) is:', options: ['The type of goods sold.', 'The timing of the cost computation.', 'The currency used.', 'There is no difference.'], a: 'The timing of the cost computation.', s: 'Weighted Average calculates one rate at period-end; Moving Average calculates a new rate after every purchase.' },
  { id: 131, type: 'Theory', topic: 'moving average perpetual theory', q: 'If a company purchases inventory at a cost higher than the current moving average, the new average will:', options: ['Decrease.', 'Increase.', 'Stay the same.', 'Be zero.'], a: 'Increase.', s: 'Adding higher-cost units to the pool "pulls up" the average cost.' },
  { id: 132, type: 'Theory', topic: 'moving average perpetual theory', q: 'If a company purchases inventory at a cost equal to the current moving average, the new average will:', options: ['Increase.', 'Decrease.', 'Remain unchanged.', 'Double.'], a: 'Remain unchanged.', s: 'Mathematically, adding values equal to the current mean does not shift the mean.' },
  { id: 133, type: 'Theory', topic: 'moving average perpetual theory', q: 'Which method requires more frequent calculations?', options: ['Weighted Average Periodic.', 'Moving Average Perpetual.', 'Specific Identification.', 'Gross Profit Method.'], a: 'Moving Average Perpetual.', s: 'It requires a new calculation every time a purchase entry is made, making it more computationally intensive than periodic methods.' },
  { id: 134, type: 'Theory', topic: 'moving average perpetual theory', q: 'In a moving average system, the "Inventory Balance" column on the stock card represents:', options: ['The sum of all purchases.', 'The quantity and total cost of goods currently held.', 'The market value of goods.', 'The potential profit.'], a: 'The quantity and total cost of goods currently held.', s: 'The balance column tracks the real-time pool of costs available for future sales.' },
  { id: 135, type: 'Theory', topic: 'moving average perpetual theory', q: 'Compared to FIFO in a period of rising prices, the Moving Average method yields a Cost of Goods Sold that is:', options: ['Lower.', 'Higher.', 'Exactly the same.', 'Zero.'], a: 'Higher.', s: 'Moving average blends in the older (cheaper) costs with newer (expensive) costs, whereas FIFO uses only the oldest (cheapest), resulting in a higher COGS for Moving Average relative to FIFO.' },
  { id: 136, type: 'Theory', topic: 'moving average perpetual theory', q: 'The Moving Average method is best described as:', options: ['A flow of costs matching physical flow.', 'A compromise that smooths out price fluctuations.', 'A method to maximize tax payments.', 'A method for expired goods.'], a: 'A compromise that smooths out price fluctuations.', s: 'It avoids the extremes of FIFO (oldest costs) and LIFO (newest costs) by blending them.' },
  { id: 137, type: 'Theory', topic: 'moving average perpetual theory', q: 'When computing the new moving average, the denominator used is:', options: ['Units Sold.', 'Units Purchased.', 'Units on Hand before purchase + Units Purchased.', 'Units on Hand after sale.'], a: 'Units on Hand before purchase + Units Purchased.', s: 'The denominator represents the total physical count of items now available to be sold.' },
  { id: 138, type: 'Theory', topic: 'moving average perpetual theory', q: 'In the Moving Average Perpetual system, the cost of ending inventory is composed of:', options: ['The oldest costs.', 'The most recent costs.', 'A blend of costs from the period.', 'The sales price.'], a: 'A blend of costs from the period.', s: 'The ending balance reflects an average that has "moved" throughout the period as purchases were made.' },
  { id: 139, type: 'Theory', topic: 'moving average perpetual theory', q: 'Why is the Moving Average method often preferred for items like fuel or chemicals?', options: ['Because they are distinct and unique.', 'Because they are physically commingled and indistinguishable.', 'Because they are expensive.', 'Because they never expire.'], a: 'Because they are physically commingled and indistinguishable.', s: 'When new oil is poured into a tank with old oil, it physically mixes; the average cost method mirrors this physical reality.' },
  { id: 140, type: 'Theory', topic: 'moving average perpetual theory', q: 'If a purchase transaction is omitted by mistake, the Moving Average unit cost for subsequent sales will be:', options: ['Correct.', 'Incorrect.', 'Unaffected.', 'Adjusted automatically.'], a: 'Incorrect.', s: 'Since every sale depends on the *current* average, a missing purchase entry distorts the average for all following transactions.' },
  { id: 141, type: 'Theory', topic: 'moving average perpetual theory', q: 'Cost of Goods Sold in this system is calculated by:', options: ['Units Sold √ó Sales Price.', 'Units Sold √ó Moving Average Unit Cost.', 'Units Sold √ó First Purchase Price.', 'Units Sold √ó Last Purchase Price.'], a: 'Units Sold √ó Moving Average Unit Cost.', s: 'The cost removed from inventory is the quantity sold multiplied by the average cost prevailing at that moment.' },
  { id: 142, type: 'Theory', topic: 'moving average perpetual theory', q: 'Which feature is unique to the "Perpetual" Moving Average compared to "Periodic" Weighted Average?', options: ['The use of averages.', 'The recording of sales.', 'The continuous update of unit costs.', 'The use of a calculator.'], a: 'The continuous update of unit costs.', s: 'Periodic systems wait until the end; Perpetual systems update continuously.' },
  { id: 143, type: 'Theory', topic: 'moving average perpetual theory', q: 'If prices are stable (no inflation or deflation), the Moving Average unit cost will:', options: ['Rise steadily.', 'Fall steadily.', 'Remain relatively constant.', 'Fluctuate wildly.'], a: 'Remain relatively constant.', s: 'Without price changes in purchases, the average has no reason to shift significantly.' },
  { id: 144, type: 'Theory', topic: 'moving average perpetual theory', q: 'The "Moving" in Moving Average implies that the average cost is:', options: ['Transported to another warehouse.', 'Dynamic and changes with time.', 'Fixed for the year.', 'Based on moving expenses.'], a: 'Dynamic and changes with time.', s: 'It implies fluidity; the value is not static and shifts with every buying decision.' },
  { id: 145, type: 'Theory', topic: 'moving average perpetual theory', q: 'When a company sells goods, the total value of the inventory on hand decreases, but the unit cost:', options: ['Increases.', 'Decreases.', 'Stays the same.', 'Becomes zero.'], a: 'Stays the same.', s: 'The *total* dollar amount drops, but since you remove goods at the current average rate, the *rate* for the remaining goods doesn\'t change.' },
  { id: 146, type: 'Theory', topic: 'moving average perpetual theory', q: 'For a business with high transaction volume, Moving Average Perpetual is usually maintained via:', options: ['Manual calculation on paper.', 'Computerized accounting systems.', 'Mental estimation.', 'Annual reviews.'], a: 'Computerized accounting systems.', s: 'Re-calculating an average to several decimal places after every single purchase is impractical to do manually for high volumes.' },
  { id: 147, type: 'Theory', topic: 'moving average perpetual theory', q: 'In this system, the "Cost of Goods Available for Sale" is split between:', options: ['COGS and Expenses.', 'Assets and Liabilities.', 'Cost of Goods Sold and Ending Inventory.', 'Cash and Credit.'], a: 'Cost of Goods Sold and Ending Inventory.', s: 'The total cost pool is allocated to either what was sold or what is left, just like other methods, but utilizing the moving average rate.' },
  { id: 148, type: 'Theory', topic: 'moving average perpetual theory', q: 'Rounding differences in calculating the moving average unit cost can lead to:', options: ['Minor discrepancies in the total inventory value.', 'Bankruptcy.', 'Tax evasion charges.', 'A change to LIFO.'], a: 'Minor discrepancies in the total inventory value.', s: 'Because averages often result in long decimals, rounding is necessary, which may cause slight immaterial differences in the final totals.' },
  { id: 149, type: 'Theory', topic: 'moving average perpetual theory', q: 'Does the Moving Average method adhere to the Cost Principle?', options: ['No, it uses market values.', 'Yes, it is based on historical costs incurred.', 'No, it uses estimates.', 'Only on Tuesdays.'], a: 'Yes, it is based on historical costs incurred.', s: 'Even though it averages them, the inputs are strictly the actual historical costs paid for the goods.' },
  { id: 150, type: 'Theory', topic: 'moving average perpetual theory', q: 'One benefit of the Moving Average Perpetual system is:', options: ['It provides an objective, verifiable cost for every sale immediately.', 'It yields the highest net income.', 'It yields the lowest taxes.', 'It eliminates the need for inventory counts.'], a: 'It provides an objective, verifiable cost for every sale immediately.', s: 'Management always knows the cost of the item sold at the moment of sale, without waiting for period-end calculations.' },
  { id: 151, type: 'Problem', topic: 'fifo periodic problem', q: 'Beg. Inventory: 1,000 units @ ‚Ç±20. Purchase: 2,000 units @ ‚Ç±25. If Ending Inventory is 500 units, what is its value under FIFO?', options: ['‚Ç±10,000', '‚Ç±12,500', '‚Ç±15,000', '‚Ç±11,250'], a: '‚Ç±12,500', s: 'FIFO Ending Inventory comes from the latest purchase. 500 units * ‚Ç±25 = ‚Ç±12,500.' },
  { id: 152, type: 'Problem', topic: 'fifo periodic problem', q: 'Beg. Inventory: 500 units @ ‚Ç±40. Purchase 1: 1,000 units @ ‚Ç±50. Purchase 2: 500 units @ ‚Ç±60. What is the Cost of Goods Available for Sale?', options: ['‚Ç±90,000', '‚Ç±95,000', '‚Ç±100,000', '‚Ç±85,000'], a: '‚Ç±100,000', s: '(500*40) + (1,000*50) + (500*60) = 20,000 + 50,000 + 30,000 = ‚Ç±100,000.' },
  { id: 153, type: 'Problem', topic: 'fifo periodic problem', q: 'Using the data from Q152 (GAS = ‚Ç±100,000), if Sales were 1,600 units, calculate the FIFO Cost of Goods Sold.', options: ['‚Ç±86,000', '‚Ç±76,000', '‚Ç±74,000', '‚Ç±80,000'], a: '‚Ç±76,000', s: 'Sold 1,600 units. Oldest first: 500 @ 40 (20k) + 1,000 @ 50 (50k) + 100 @ 60 (6k) = ‚Ç±76,000.' },
  { id: 154, type: 'Problem', topic: 'fifo periodic problem', q: 'A company reports Goods Available for Sale of ‚Ç±150,000. A physical count shows Ending Inventory valued at ‚Ç±35,000 (FIFO). What is the Cost of Goods Sold?', options: ['‚Ç±115,000', '‚Ç±125,000', '‚Ç±185,000', '‚Ç±110,000'], a: '‚Ç±115,000', s: 'GAS (‚Ç±150,000) - Ending Inventory (‚Ç±35,000) = COGS (‚Ç±115,000).' },
  { id: 155, type: 'Problem', topic: 'fifo periodic problem', q: 'Beg Inv: 2,000 units @ ‚Ç±10. Purchases: 3,000 units @ ‚Ç±15. If 4,000 units are sold, what is the value of the Ending Inventory?', options: ['‚Ç±15,000', '‚Ç±10,000', '‚Ç±12,500', '‚Ç±20,000'], a: '‚Ç±15,000', s: 'Total 5,000 units - 4,000 sold = 1,000 units remaining. Under FIFO, these are from the latest purchase (‚Ç±15). 1,000 * 15 = ‚Ç±15,000.' },
  { id: 156, type: 'Problem', topic: 'fifo periodic problem', q: 'Jan 1: 1,000 units @ ‚Ç±100. Jan 15: 2,000 units @ ‚Ç±120. Jan 30: 1,000 units @ ‚Ç±130. Ending Inventory is 1,500 units. Calculate its cost.', options: ['‚Ç±180,000', '‚Ç±190,000', '‚Ç±185,000', '‚Ç±175,000'], a: '‚Ç±190,000', s: 'EI is latest 1,500. All Jan 30 (1,000 @ 130 = 130k) + Part Jan 15 (500 @ 120 = 60k). Total = ‚Ç±190,000.' },
  { id: 157, type: 'Problem', topic: 'fifo periodic problem', q: 'Using the data from Q156 (EI = ‚Ç±190,000), calculate the Cost of Goods Sold knowing the total Goods Available was ‚Ç±470,000.', options: ['‚Ç±280,000', '‚Ç±290,000', '‚Ç±300,000', '‚Ç±270,000'], a: '‚Ç±280,000', s: 'GAS (470,000) - EI (190,000) = COGS (‚Ç±280,000).' },
  { id: 158, type: 'Problem', topic: 'fifo periodic problem', q: 'Purchases in order: 500 @ ‚Ç±80; 600 @ ‚Ç±90; 400 @ ‚Ç±100. Sales: 1,100 units. What is the FIFO cost of the unsold units?', options: ['‚Ç±40,000', '‚Ç±36,000', '‚Ç±45,000', '‚Ç±32,000'], a: '‚Ç±40,000', s: 'Total units 1,500. Sold 1,100. Unsold 400. FIFO implies unsold are the newest (the 400 @ 100). 400 * 100 = ‚Ç±40,000.' },
  { id: 159, type: 'Problem', topic: 'fifo periodic problem', q: 'Beg Inv: ‚Ç±25,000 (500 units). Purchase 1: ‚Ç±60,000 (1,000 units). Purchase 2: ‚Ç±35,000 (500 units). Calculate total Goods Available for Sale.', options: ['‚Ç±120,000', '‚Ç±115,000', '‚Ç±125,000', '‚Ç±110,000'], a: '‚Ç±120,000', s: 'Simply sum the costs: 25,000 + 60,000 + 35,000 = ‚Ç±120,000.' },
  { id: 160, type: 'Problem', topic: 'fifo periodic problem', q: 'Inventory Layers: (1) 2,000 @ ‚Ç±10. (2) 3,000 @ ‚Ç±12. (3) 1,000 @ ‚Ç±14. If Sales are 4,000 units, calculate COGS.', options: ['‚Ç±44,000', '‚Ç±42,000', '‚Ç±46,000', '‚Ç±48,000'], a: '‚Ç±44,000', s: 'Oldest sold first: All Layer 1 (2,000@10 = 20k) + Part Layer 2 (2,000@12 = 24k). Total = ‚Ç±44,000.' },
  { id: 161, type: 'Problem', topic: 'fifo periodic problem', q: 'Batch A: 1,000 units (Total ‚Ç±50,000). Batch B: 2,000 units (Total ‚Ç±120,000). Sales: 2,500 units. What is the value of Ending Inventory?', options: ['‚Ç±30,000', '‚Ç±60,000', '‚Ç±25,000', '‚Ç±35,000'], a: '‚Ç±30,000', s: 'Total 3,000 units. Sold 2,500. EI = 500 units. Batch B unit cost = 120k/2k = ‚Ç±60. EI comes from Batch B. 500 * 60 = ‚Ç±30,000.' },
  { id: 162, type: 'Problem', topic: 'fifo periodic problem', q: 'Beg Inv: 5,000 units @ ‚Ç±2. Purchases: 10,000 units @ ‚Ç±3. Sales: 12,000 units @ ‚Ç±5 (Total Sales ‚Ç±60,000). Calculate Gross Profit.', options: ['‚Ç±29,000', '‚Ç±31,000', '‚Ç±30,000', '‚Ç±25,000'], a: '‚Ç±29,000', s: 'COGS: 5,000@2 (10k) + 7,000@3 (21k) = 31,000. Gross Profit = Sales 60,000 - COGS 31,000 = ‚Ç±29,000.' },
  { id: 163, type: 'Problem', topic: 'fifo periodic problem', q: 'If the Cost of Goods Sold is ‚Ç±85,000 and the Ending Inventory is ‚Ç±15,000, what was the Cost of Goods Available for Sale?', options: ['‚Ç±100,000', '‚Ç±110,000', '‚Ç±105,000', '‚Ç±115,000'], a: '‚Ç±100,000', s: 'COGS + Ending Inventory = Goods Available for Sale. 85,000 + 15,000 = ‚Ç±100,000.' },
  { id: 164, type: 'Problem', topic: 'fifo periodic problem', q: 'Store has 3 purchases: (1) 1,000 @ ‚Ç±20; (2) 1,000 @ ‚Ç±22; (3) 1,000 @ ‚Ç±25. If Ending Inventory is 1,200 units, what is its cost?', options: ['‚Ç±29,400', '‚Ç±30,000', '‚Ç±28,000', '‚Ç±29,000'], a: '‚Ç±29,400', s: 'EI is latest 1,200. All Batch 3 (1,000@25 = 25,000) + 200 from Batch 2 (200@22 = 4,400). Total = ‚Ç±29,400.' },
  { id: 165, type: 'Problem', topic: 'fifo periodic problem', q: 'Store has 3 purchases: (1) 1,000 @ ‚Ç±20; (2) 1,000 @ ‚Ç±22; (3) 1,000 @ ‚Ç±25. If 1,800 units are sold, what is the COGS?', options: ['‚Ç±37,600', '‚Ç±38,000', '‚Ç±39,000', '‚Ç±36,000'], a: '‚Ç±37,600', s: 'Sold oldest 1,800. All Batch 1 (1,000@20 = 20k) + 800 from Batch 2 (800@22 = 17,600). Total = ‚Ç±37,600.' },
  { id: 166, type: 'Problem', topic: 'fifo periodic problem', q: 'Beg Inv: 400 @ ‚Ç±50. Purchase: 600 @ ‚Ç±60. Ending Inventory is 200 units. What is the Cost of Goods Sold?', options: ['‚Ç±44,000', '‚Ç±56,000', '‚Ç±48,000', '‚Ç±50,000'], a: '‚Ç±44,000', s: 'GAS = 20k + 36k = 56k. EI (Latest 200) = 200@60 = 12k. COGS = 56k - 12k = ‚Ç±44,000.' },
  { id: 167, type: 'Problem', topic: 'fifo periodic problem', q: 'Beg Inv: ‚Ç±12,000. Purchases: ‚Ç±88,000. Ending Inventory count shows 1,500 units valued at ‚Ç±20 each. Calculate COGS.', options: ['‚Ç±70,000', '‚Ç±80,000', '‚Ç±68,000', '‚Ç±72,000'], a: '‚Ç±70,000', s: 'GAS = 12k + 88k = 100k. EI = 1,500 * 20 = 30k. COGS = 100k - 30k = ‚Ç±70,000.' },
  { id: 168, type: 'Problem', topic: 'fifo periodic problem', q: 'Product X costs: Lot 1 (500 units @ ‚Ç±100); Lot 2 (500 units @ ‚Ç±110). If 750 units are sold, what is the value of the remaining inventory?', options: ['‚Ç±27,500', '‚Ç±25,000', '‚Ç±22,500', '‚Ç±28,000'], a: '‚Ç±27,500', s: 'Total 1,000. Sold 750. Remaining 250 units. Under FIFO, these are from Lot 2. 250 * 110 = ‚Ç±27,500.' },
  { id: 169, type: 'Problem', topic: 'fifo periodic problem', q: 'A company sold 5,000 units. The cost layers available were: 2,000 @ ‚Ç±5; 2,000 @ ‚Ç±6; 2,000 @ ‚Ç±7. What is the total COGS?', options: ['‚Ç±29,000', '‚Ç±30,000', '‚Ç±28,000', '‚Ç±35,000'], a: '‚Ç±29,000', s: 'Oldest 5,000: 2,000@5 (10k) + 2,000@6 (12k) + 1,000@7 (7k) = ‚Ç±29,000.' },
  { id: 170, type: 'Problem', topic: 'fifo periodic problem', q: 'Using the data from Q169 (Layers: 2k@5, 2k@6, 2k@7), what is the value of the Ending Inventory (1,000 units remaining)?', options: ['‚Ç±7,000', '‚Ç±6,000', '‚Ç±5,000', '‚Ç±8,000'], a: '‚Ç±7,000', s: 'Remaining 1,000 units are from the newest layer (‚Ç±7). 1,000 * 7 = ‚Ç±7,000.' },
  { id: 171, type: 'Problem', topic: 'fifo periodic problem', q: 'Purchased 2,000 units @ ‚Ç±10 and 3,000 units @ ‚Ç±12. Sold 4,500 units. Determine cost of the 500 units in Ending Inventory.', options: ['‚Ç±6,000', '‚Ç±5,000', '‚Ç±5,500', '‚Ç±6,500'], a: '‚Ç±6,000', s: 'Ending Inventory comes from the very last purchase batch (‚Ç±12). 500 * 12 = ‚Ç±6,000.' },
  { id: 172, type: 'Problem', topic: 'fifo periodic problem', q: 'Beg Inv: 1,000 units (Total ‚Ç±10,000). Purchases: 4,000 units (Total ‚Ç±48,000). If COGS is ‚Ç±46,000, what is the value of Ending Inventory?', options: ['‚Ç±12,000', '‚Ç±10,000', '‚Ç±14,000', '‚Ç±11,000'], a: '‚Ç±12,000', s: 'GAS = 10k + 48k = 58k. EI = GAS - COGS = 58k - 46k = ‚Ç±12,000.' },
  { id: 173, type: 'Problem', topic: 'fifo periodic problem', q: 'Unit costs: Jan (‚Ç±100), Feb (‚Ç±110), Mar (‚Ç±120). Qty purchased each month: 500. If 400 units are on hand at end of Mar, value them.', options: ['‚Ç±48,000', '‚Ç±40,000', '‚Ç±44,000', '‚Ç±42,000'], a: '‚Ç±48,000', s: 'The 400 units on hand are from the latest batch (March @ ‚Ç±120). 400 * 120 = ‚Ç±48,000.' },
  { id: 174, type: 'Problem', topic: 'fifo periodic problem', q: 'Total units available: 10,000. Total Cost: ‚Ç±200,000. FIFO Ending Inventory is 2,000 units valued at ‚Ç±50,000. What is the average cost of the units SOLD?', options: ['‚Ç±18.75', '‚Ç±20.00', '‚Ç±25.00', '‚Ç±15.00'], a: '‚Ç±18.75', s: 'COGS = 200k - 50k = 150k. Units Sold = 8,000. Avg Cost = 150,000 / 8,000 = ‚Ç±18.75.' },
  { id: 175, type: 'Problem', topic: 'fifo periodic problem', q: 'Beg Inv 10,000 units @ ‚Ç±5. Purchases 20,000 units @ ‚Ç±6. Purchases 20,000 units @ ‚Ç±8. Ending Inventory is 15,000 units. Calculate COGS.', options: ['‚Ç±210,000', '‚Ç±220,000', '‚Ç±200,000', '‚Ç±230,000'], a: '‚Ç±210,000', s: 'EI (15k units) is valued at 15k*8 = 120k. GAS = (10k*5)+(20k*6)+(20k*8) = 50+120+160=330k. COGS = 330k - 120k = ‚Ç±210,000.' },
  { id: 176, type: 'Problem', topic: 'weighted average periodic problem', q: 'Beg Inv: 1,000 units @ ‚Ç±50. Purchases: 3,000 units @ ‚Ç±60. Total Units Available: 4,000. Total Cost: ‚Ç±230,000. Calculate the weighted average unit cost.', options: ['‚Ç±57.50', '‚Ç±55.00', '‚Ç±58.00', '‚Ç±52.50'], a: '‚Ç±57.50', s: 'Average Cost = Total Cost / Total Units. ‚Ç±230,000 / 4,000 units = ‚Ç±57.50.' },
  { id: 177, type: 'Problem', topic: 'weighted average periodic problem', q: 'Using the data from Q176 (Avg Cost ‚Ç±57.50), if Ending Inventory is 500 units, what is its value?', options: ['‚Ç±28,750', '‚Ç±29,000', '‚Ç±27,500', '‚Ç±28,000'], a: '‚Ç±28,750', s: 'Ending Inventory = 500 units * ‚Ç±57.50 = ‚Ç±28,750.' },
  { id: 178, type: 'Problem', topic: 'weighted average periodic problem', q: 'Beg Inv: 2,000 units @ ‚Ç±20. Purchases: 8,000 units @ ‚Ç±25. What is the total cost of Goods Available for Sale?', options: ['‚Ç±240,000', '‚Ç±200,000', '‚Ç±250,000', '‚Ç±220,000'], a: '‚Ç±240,000', s: '(2,000*20) + (8,000*25) = 40,000 + 200,000 = ‚Ç±240,000.' },
  { id: 179, type: 'Problem', topic: 'weighted average periodic problem', q: 'Using data from Q178 (GAS ‚Ç±240,000, 10,000 units), if 7,000 units are sold, calculate the Cost of Goods Sold.', options: ['‚Ç±168,000', '‚Ç±175,000', '‚Ç±160,000', '‚Ç±170,000'], a: '‚Ç±168,000', s: 'Avg Cost = 240,000 / 10,000 = ‚Ç±24. COGS = 7,000 units * ‚Ç±24 = ‚Ç±168,000.' },
  { id: 180, type: 'Problem', topic: 'weighted average periodic problem', q: 'Lot A: 500 units @ ‚Ç±100. Lot B: 1,500 units @ ‚Ç±120. Calculate the weighted average cost per unit.', options: ['‚Ç±115.00', '‚Ç±110.00', '‚Ç±112.50', '‚Ç±118.00'], a: '‚Ç±115.00', s: 'Total Cost = 50,000 + 180,000 = 230,000. Total Units = 2,000. 230,000 / 2,000 = ‚Ç±115.' },
  { id: 181, type: 'Problem', topic: 'weighted average periodic problem', q: 'A company has 10,000 units available for sale at a total cost of ‚Ç±500,000. If the physical count shows 2,000 units remaining, what is the value of Ending Inventory?', options: ['‚Ç±100,000', '‚Ç±120,000', '‚Ç±50,000', '‚Ç±80,000'], a: '‚Ç±100,000', s: 'Avg Cost = 500,000 / 10,000 = ‚Ç±50. EI = 2,000 units * ‚Ç±50 = ‚Ç±100,000.' },
  { id: 182, type: 'Problem', topic: 'weighted average periodic problem', q: 'Beg Inv: 100 units @ ‚Ç±1,000. Purchase: 400 units @ ‚Ç±1,250. Calculate the weighted average unit cost.', options: ['‚Ç±1,200', '‚Ç±1,150', '‚Ç±1,125', '‚Ç±1,100'], a: '‚Ç±1,200', s: 'Total Cost = 100,000 + 500,000 = 600,000. Total Units = 500. 600,000 / 500 = ‚Ç±1,200.' },
  { id: 183, type: 'Problem', topic: 'weighted average periodic problem', q: 'Using data from Q182 (Avg Cost ‚Ç±1,200), if 350 units are sold, calculate COGS.', options: ['‚Ç±420,000', '‚Ç±400,000', '‚Ç±450,000', '‚Ç±437,500'], a: '‚Ç±420,000', s: 'COGS = 350 units * ‚Ç±1,200 = ‚Ç±420,000.' },
  { id: 184, type: 'Problem', topic: 'weighted average periodic problem', q: 'Purchases: 1,000 @ ‚Ç±10; 2,000 @ ‚Ç±12; 2,000 @ ‚Ç±13.50. Calculate Total Goods Available for Sale (Value).', options: ['‚Ç±61,000', '‚Ç±60,000', '‚Ç±62,000', '‚Ç±59,000'], a: '‚Ç±61,000', s: '(1,000*10) + (2,000*12) + (2,000*13.5) = 10k + 24k + 27k = ‚Ç±61,000.' },
  { id: 185, type: 'Problem', topic: 'weighted average periodic problem', q: 'Using data from Q184 (Total Value ‚Ç±61,000, Total Units 5,000), calculate the weighted average unit cost.', options: ['‚Ç±12.20', '‚Ç±12.00', '‚Ç±11.80', '‚Ç±12.50'], a: '‚Ç±12.20', s: '61,000 / 5,000 = ‚Ç±12.20.' },
  { id: 186, type: 'Problem', topic: 'weighted average periodic problem', q: 'If Goods Available for Sale is ‚Ç±150,000 (15,000 units) and Ending Inventory is 5,000 units, calculate COGS.', options: ['‚Ç±100,000', '‚Ç±50,000', '‚Ç±75,000', '‚Ç±125,000'], a: '‚Ç±100,000', s: 'Avg Cost = 150k/15k = ‚Ç±10. Units Sold = 10,000. COGS = 10,000 * 10 = ‚Ç±100,000. (Or GAS 150k - EI 50k).' },
  { id: 187, type: 'Problem', topic: 'weighted average periodic problem', q: 'Beg Inv: 500 units (Total ‚Ç±25,000). Purchase: 1,500 units (Total ‚Ç±85,000). Sales: 1,200 units. Calculate value of Ending Inventory.', options: ['‚Ç±44,000', '‚Ç±42,000', '‚Ç±40,000', '‚Ç±45,000'], a: '‚Ç±44,000', s: 'Total Cost = 110,000. Total Units = 2,000. Avg = ‚Ç±55. Remaining units = 800. 800 * 55 = ‚Ç±44,000.' },
  { id: 188, type: 'Problem', topic: 'weighted average periodic problem', q: 'Unit costs: ‚Ç±10, ‚Ç±12, ‚Ç±15. Quantities purchased: 1,000 of each. Calculate weighted average unit cost.', options: ['‚Ç±12.33', '‚Ç±12.00', '‚Ç±12.50', '‚Ç±11.50'], a: '‚Ç±12.33', s: 'Total Cost = 10k+12k+15k = 37,000. Total Units = 3,000. 37,000 / 3,000 = ‚Ç±12.333...' },
  { id: 189, type: 'Problem', topic: 'weighted average periodic problem', q: 'Using data from Q188 (Avg Cost ‚Ç±12.333), if 2,000 units are sold, calculate COGS (round to nearest whole number).', options: ['‚Ç±24,667', '‚Ç±24,000', '‚Ç±25,000', '‚Ç±23,500'], a: '‚Ç±24,667', s: '2,000 * 12.3333 = ‚Ç±24,666.67, rounds to ‚Ç±24,667.' },
  { id: 190, type: 'Problem', topic: 'weighted average periodic problem', q: 'Beg Inv: ‚Ç±200,000 (10,000 units). Purchase: ‚Ç±300,000 (10,000 units). Ending Inventory is 5,000 units. What is the value of Ending Inventory?', options: ['‚Ç±125,000', '‚Ç±100,000', '‚Ç±150,000', '‚Ç±130,000'], a: '‚Ç±125,000', s: 'Total Cost 500,000. Total Units 20,000. Avg = ‚Ç±25. EI = 5,000 * 25 = ‚Ç±125,000.' },
  { id: 191, type: 'Problem', topic: 'weighted average periodic problem', q: 'A company has 5,000 units available at an average cost of ‚Ç±40. They sell 3,000 units at ‚Ç±80 each. What is the Gross Profit?', options: ['‚Ç±120,000', '‚Ç±100,000', '‚Ç±150,000', '‚Ç±240,000'], a: '‚Ç±120,000', s: 'Sales = 3,000 * 80 = 240,000. COGS = 3,000 * 40 = 120,000. GP = 240k - 120k = ‚Ç±120,000.' },
  { id: 192, type: 'Problem', topic: 'weighted average periodic problem', q: 'Purchases: 100 units @ ‚Ç±500; 200 units @ ‚Ç±560; 100 units @ ‚Ç±600. Calculate weighted average unit cost.', options: ['‚Ç±555.00', '‚Ç±550.00', '‚Ç±560.00', '‚Ç±540.00'], a: '‚Ç±555.00', s: 'Total Cost = 50k + 112k + 60k = 222,000. Units = 400. 222,000 / 400 = ‚Ç±555.' },
  { id: 193, type: 'Problem', topic: 'weighted average periodic problem', q: 'Using data from Q192 (Avg Cost ‚Ç±555), if Ending Inventory is 150 units, calculate COGS.', options: ['‚Ç±138,750', '‚Ç±140,000', '‚Ç±135,000', '‚Ç±150,000'], a: '‚Ç±138,750', s: 'Total Units 400. EI 150. Sold 250. COGS = 250 * 555 = ‚Ç±138,750.' },
  { id: 194, type: 'Problem', topic: 'weighted average periodic problem', q: 'Beg Inv: 1,000 @ ‚Ç±2. Purchases: 4,000 @ ‚Ç±3.25. Total Units 5,000. Calculate weighted average unit cost.', options: ['‚Ç±3.00', '‚Ç±2.75', '‚Ç±3.10', '‚Ç±2.90'], a: '‚Ç±3.00', s: 'Cost = 2,000 + 13,000 = 15,000. Units = 5,000. 15,000 / 5,000 = ‚Ç±3.00.' },
  { id: 195, type: 'Problem', topic: 'weighted average periodic problem', q: 'If Total Cost of Goods Available is ‚Ç±800,000 and Total Units is 20,000, what is the value of 4,500 units in Ending Inventory?', options: ['‚Ç±180,000', '‚Ç±160,000', '‚Ç±200,000', '‚Ç±175,000'], a: '‚Ç±180,000', s: 'Avg Cost = 800k/20k = ‚Ç±40. EI = 4,500 * 40 = ‚Ç±180,000.' },
  { id: 196, type: 'Problem', topic: 'weighted average periodic problem', q: 'Beg Inv: 2,500 units @ ‚Ç±100. Purchase: 7,500 units @ ‚Ç±120. Sales: 6,000 units. Calculate Cost of Goods Sold.', options: ['‚Ç±690,000', '‚Ç±660,000', '‚Ç±720,000', '‚Ç±600,000'], a: '‚Ç±690,000', s: 'Total Cost = 250k + 900k = 1,150,000. Total Units = 10,000. Avg = ‚Ç±115. COGS = 6,000 * 115 = ‚Ç±690,000.' },
  { id: 197, type: 'Problem', topic: 'weighted average periodic problem', q: 'Using data from Q196 (Avg Cost ‚Ç±115, Remaining 4,000 units), what is the Ending Inventory value?', options: ['‚Ç±460,000', '‚Ç±400,000', '‚Ç±480,000', '‚Ç±450,000'], a: '‚Ç±460,000', s: '4,000 units * ‚Ç±115 = ‚Ç±460,000.' },
  { id: 198, type: 'Problem', topic: 'weighted average periodic problem', q: 'Lot 1: 500 @ ‚Ç±800. Lot 2: 500 @ ‚Ç±900. Lot 3: 1,000 @ ‚Ç±950. Calculate weighted average unit cost.', options: ['‚Ç±900.00', '‚Ç±883.33', '‚Ç±925.00', '‚Ç±910.00'], a: '‚Ç±900.00', s: 'Costs: 400k + 450k + 950k = 1,800,000. Units: 2,000. 1.8M / 2,000 = ‚Ç±900.' },
  { id: 199, type: 'Problem', topic: 'weighted average periodic problem', q: 'Using data from Q198 (Avg Cost ‚Ç±900), if 1,500 units are sold, what is the COGS?', options: ['‚Ç±1,350,000', '‚Ç±1,300,000', '‚Ç±1,400,000', '‚Ç±1,250,000'], a: '‚Ç±1,350,000', s: '1,500 units * ‚Ç±900 = ‚Ç±1,350,000.' },
  { id: 200, type: 'Problem', topic: 'weighted average periodic problem', q: 'Beg Inv: 10,000 units @ ‚Ç±5. Purchases: 30,000 @ ‚Ç±6 and 10,000 @ ‚Ç±8. Calculate Total Cost of Goods Available.', options: ['‚Ç±310,000', '‚Ç±300,000', '‚Ç±320,000', '‚Ç±290,000'], a: '‚Ç±310,000', s: '50,000 + 180,000 + 80,000 = ‚Ç±310,000.' },
  { id: 201, type: 'Problem', topic: 'fifo perpetual problem', q: 'Beg Inv: 1,000 units @ ‚Ç±50. Jan 5: Sold 400 units. Calculate Cost of Goods Sold.', options: ['‚Ç±20,000', '‚Ç±25,000', '‚Ç±15,000', '‚Ç±10,000'], a: '‚Ç±20,000', s: '400 units * ‚Ç±50 = ‚Ç±20,000.' },
  { id: 202, type: 'Problem', topic: 'fifo perpetual problem', q: 'Beg Inv: 1,000 units @ ‚Ç±20. Purch: 1,000 units @ ‚Ç±25. Sold 800 units. Calculate Ending Inventory value.', options: ['‚Ç±29,000', '‚Ç±30,000', '‚Ç±25,000', '‚Ç±24,000'], a: '‚Ç±29,000', s: 'Remaining: 200 @ 20 (4,000) + 1,000 @ 25 (25,000) = ‚Ç±29,000.' },
  { id: 203, type: 'Problem', topic: 'fifo perpetual problem', q: 'Jan 1: 500 units @ ‚Ç±100. Jan 2: Purch 500 units @ ‚Ç±110. Jan 3: Sold 700 units. Calculate COGS.', options: ['‚Ç±72,000', '‚Ç±75,000', '‚Ç±77,000', '‚Ç±70,000'], a: '‚Ç±72,000', s: '500 @ 100 (50k) + 200 @ 110 (22k) = ‚Ç±72,000.' },
  { id: 204, type: 'Problem', topic: 'fifo perpetual problem', q: 'Using data from Q203 (Sold 700 units), calculate the value of the Ending Inventory.', options: ['‚Ç±33,000', '‚Ç±30,000', '‚Ç±35,000', '‚Ç±32,000'], a: '‚Ç±33,000', s: 'Remaining 300 units from the second batch @ 110. 300 * 110 = ‚Ç±33,000.' },
  { id: 205, type: 'Problem', topic: 'fifo perpetual problem', q: 'Beg Inv: 1,000 units @ ‚Ç±50. Purch: 1,000 units @ ‚Ç±60. Sold 1,200 units. Calculate COGS.', options: ['‚Ç±62,000', '‚Ç±60,000', '‚Ç±72,000', '‚Ç±65,000'], a: '‚Ç±62,000', s: '1,000 @ 50 (50k) + 200 @ 60 (12k) = ‚Ç±62,000.' },
  { id: 206, type: 'Problem', topic: 'fifo perpetual problem', q: 'Sold 1,000 units for ‚Ç±100,000. Cost layers used: 500 @ ‚Ç±60 and 500 @ ‚Ç±70. Calculate Gross Profit.', options: ['‚Ç±35,000', '‚Ç±40,000', '‚Ç±30,000', '‚Ç±45,000'], a: '‚Ç±35,000', s: 'COGS = 30k + 35k = 65k. Sales 100k - COGS 65k = ‚Ç±35,000.' },
  { id: 207, type: 'Problem', topic: 'fifo perpetual problem', q: 'Inventory contains 100 units @ ‚Ç±500. Sold 40 units. Calculate COGS.', options: ['‚Ç±20,000', '‚Ç±25,000', '‚Ç±15,000', '‚Ç±18,000'], a: '‚Ç±20,000', s: '40 * 500 = ‚Ç±20,000.' },
  { id: 208, type: 'Problem', topic: 'fifo perpetual problem', q: 'Beg: 200 @ ‚Ç±200. Purch: 300 @ ‚Ç±220. Sold 150. Then Sold 200. Calculate COGS for the SECOND sale only.', options: ['‚Ç±43,000', '‚Ç±44,000', '‚Ç±40,000', '‚Ç±42,000'], a: '‚Ç±43,000', s: 'Rem after 1st sale: 50 @ 200. 2nd sale takes 50 @ 200 (10k) + 150 @ 220 (33k) = ‚Ç±43,000.' },
  { id: 209, type: 'Problem', topic: 'fifo perpetual problem', q: 'Beg Inv 500 @ ‚Ç±40. Purch 500 @ ‚Ç±50. Sold 600 units. Calculate Ending Inventory.', options: ['‚Ç±20,000', '‚Ç±25,000', '‚Ç±24,000', '‚Ç±16,000'], a: '‚Ç±20,000', s: 'Remaining 400 units @ 50 = ‚Ç±20,000.' },
  { id: 210, type: 'Problem', topic: 'fifo perpetual problem', q: 'Beg Inv: 2,000 @ ‚Ç±10. Purch: 2,000 @ ‚Ç±12. Sold 1,500 units. Calculate COGS.', options: ['‚Ç±15,000', '‚Ç±18,000', '‚Ç±12,000', '‚Ç±20,000'], a: '‚Ç±15,000', s: '1,500 units comes entirely from Beg Inv. 1,500 * 10 = ‚Ç±15,000.' },
  { id: 211, type: 'Problem', topic: 'fifo perpetual problem', q: 'Beg: 500 @ ‚Ç±100. Sold 200. Purch 500 @ ‚Ç±110. Sold 500. Calculate COGS of second sale.', options: ['‚Ç±52,000', '‚Ç±55,000', '‚Ç±50,000', '‚Ç±53,000'], a: '‚Ç±52,000', s: 'Rem from Beg: 300 @ 100. Sale takes 300 @ 100 (30k) + 200 @ 110 (22k) = ‚Ç±52,000.' },
  { id: 212, type: 'Problem', topic: 'fifo perpetual problem', q: 'Beg 1,000 @ ‚Ç±20. Purch 1,000 @ ‚Ç±22. Purch 1,000 @ ‚Ç±25. Sold 1,500. Calculate Ending Inv.', options: ['‚Ç±36,000', '‚Ç±37,500', '‚Ç±33,000', '‚Ç±40,000'], a: '‚Ç±36,000', s: 'Rem: 500 @ 22 (11k) + 1,000 @ 25 (25k) = ‚Ç±36,000.' },
  { id: 213, type: 'Problem', topic: 'fifo perpetual problem', q: 'Layers: 1,000 @ ‚Ç±50; 1,000 @ ‚Ç±60. Sold 800. Then Sold 400. Calculate COGS of the second sale.', options: ['‚Ç±22,000', '‚Ç±20,000', '‚Ç±24,000', '‚Ç±21,000'], a: '‚Ç±22,000', s: 'Rem from Layer 1: 200 @ 50. Sale takes 200 @ 50 (10k) + 200 @ 60 (12k) = ‚Ç±22,000.' },
  { id: 214, type: 'Problem', topic: 'fifo perpetual problem', q: 'Beg Inv 1,000 @ ‚Ç±80. Sold 200. Calculate Ending Inventory.', options: ['‚Ç±64,000', '‚Ç±80,000', '‚Ç±16,000', '‚Ç±60,000'], a: '‚Ç±64,000', s: '800 units remaining @ 80 = ‚Ç±64,000.' },
  { id: 215, type: 'Problem', topic: 'fifo perpetual problem', q: 'Purch 1,000 @ ‚Ç±100. Purch 1,000 @ ‚Ç±120. Sold 1,200. Calculate COGS.', options: ['‚Ç±124,000', '‚Ç±120,000', '‚Ç±144,000', '‚Ç±130,000'], a: '‚Ç±124,000', s: '1,000 @ 100 (100k) + 200 @ 120 (24k) = ‚Ç±124,000.' },
  { id: 216, type: 'Problem', topic: 'fifo perpetual problem', q: 'Beg 2,000 @ ‚Ç±15. Purch 3,000 @ ‚Ç±20. Sold 2,500. Purch 2,000 @ ‚Ç±25. Calculate EI.', options: ['‚Ç±100,000', '‚Ç±95,000', '‚Ç±112,500', '‚Ç±90,000'], a: '‚Ç±100,000', s: 'Rem: 2,500 @ 20 (50k) + 2,000 @ 25 (50k) = ‚Ç±100,000.' },
  { id: 217, type: 'Problem', topic: 'fifo perpetual problem', q: 'Inventory: 100 units @ ‚Ç±200. Sold 60 units. Calculate COGS.', options: ['‚Ç±12,000', '‚Ç±10,000', '‚Ç±14,000', '‚Ç±20,000'], a: '‚Ç±12,000', s: '60 * 200 = ‚Ç±12,000.' },
  { id: 218, type: 'Problem', topic: 'fifo perpetual problem', q: 'Purch 500 @ ‚Ç±40. Purch 500 @ ‚Ç±44. Sold 600. Calculate Ending Inventory.', options: ['‚Ç±17,600', '‚Ç±16,000', '‚Ç±20,000', '‚Ç±18,000'], a: '‚Ç±17,600', s: 'Remaining 400 units from second batch @ 44. 400 * 44 = ‚Ç±17,600.' },
  { id: 219, type: 'Problem', topic: 'fifo perpetual problem', q: 'Inv Available: 400 @ ‚Ç±30; 600 @ ‚Ç±35. Sold 500 units. Calculate COGS.', options: ['‚Ç±15,500', '‚Ç±17,500', '‚Ç±15,000', '‚Ç±16,500'], a: '‚Ç±15,500', s: '400 @ 30 (12k) + 100 @ 35 (3.5k) = ‚Ç±15,500.' },
  { id: 220, type: 'Problem', topic: 'fifo perpetual problem', q: 'Inv: 1,000 @ ‚Ç±55. Purch 1,000 @ ‚Ç±60. Sold 1,500 units. Calculate Ending Inv.', options: ['‚Ç±30,000', '‚Ç±27,500', '‚Ç±33,000', '‚Ç±25,000'], a: '‚Ç±30,000', s: 'Remaining 500 units @ 60 = ‚Ç±30,000.' },
  { id: 221, type: 'Problem', topic: 'fifo perpetual problem', q: 'Beg 5,000 @ ‚Ç±4. Sold 3,000. Calculate COGS.', options: ['‚Ç±12,000', '‚Ç±20,000', '‚Ç±15,000', '‚Ç±10,000'], a: '‚Ç±12,000', s: '3,000 * 4 = ‚Ç±12,000.' },
  { id: 222, type: 'Problem', topic: 'fifo perpetual problem', q: 'Beg 1k@20. Purch 1k@24. Sold 1.5k. Purch 1k@28. Sold 1k. Calculate Ending Inv.', options: ['‚Ç±14,000', '‚Ç±12,000', '‚Ç±10,000', '‚Ç±16,000'], a: '‚Ç±14,000', s: 'Rem after 1st sale: 500@24. 2nd sale takes 500@24 + 500@28. Rem: 500@28 = ‚Ç±14,000.' },
  { id: 223, type: 'Problem', topic: 'fifo perpetual problem', q: 'Beg 2,000 @ ‚Ç±50. Purch 3,000 @ ‚Ç±55. Sold 4,000. Calculate COGS.', options: ['‚Ç±210,000', '‚Ç±200,000', '‚Ç±220,000', '‚Ç±215,000'], a: '‚Ç±210,000', s: '2,000 @ 50 (100k) + 2,000 @ 55 (110k) = ‚Ç±210,000.' },
  { id: 224, type: 'Problem', topic: 'fifo perpetual problem', q: 'Purch 500 @ ‚Ç±200. Sold 100. Calculate Ending Inv.', options: ['‚Ç±80,000', '‚Ç±90,000', '‚Ç±100,000', '‚Ç±40,000'], a: '‚Ç±80,000', s: '400 units @ 200 = ‚Ç±80,000.' },
  { id: 225, type: 'Problem', topic: 'fifo perpetual problem', q: 'Beg 100@100. Purch 100@110. Purch 100@120. Sold 250. Calculate COGS.', options: ['‚Ç±27,000', '‚Ç±30,000', '‚Ç±25,000', '‚Ç±33,000'], a: '‚Ç±27,000', s: '100@100 (10k) + 100@110 (11k) + 50@120 (6k) = ‚Ç±27,000.' },
  { id: 226, type: 'Problem', topic: 'moving average perpetual problem', q: 'Beg Inv: 1,000 units @ ‚Ç±50. Purch: 1,000 units @ ‚Ç±60. What is the new moving average unit cost?', options: ['‚Ç±55.00', '‚Ç±50.00', '‚Ç±60.00', '‚Ç±52.50'], a: '‚Ç±55.00', s: '(50,000 + 60,000) / 2,000 units = ‚Ç±55.00.' },
  { id: 227, type: 'Problem', topic: 'moving average perpetual problem', q: 'Using data from Q226 (Avg ‚Ç±55), if 500 units are sold, calculate the Cost of Goods Sold.', options: ['‚Ç±27,500', '‚Ç±25,000', '‚Ç±30,000', '‚Ç±22,500'], a: '‚Ç±27,500', s: '500 units * ‚Ç±55 = ‚Ç±27,500.' },
  { id: 228, type: 'Problem', topic: 'moving average perpetual problem', q: 'Beg Inv: 500 units @ ‚Ç±100. Purch: 500 units @ ‚Ç±120. Calculate the total value of Ending Inventory.', options: ['‚Ç±110,000', '‚Ç±100,000', '‚Ç±120,000', '‚Ç±105,000'], a: '‚Ç±110,000', s: 'Total Cost = (500*100) + (500*120) = 50,000 + 60,000 = ‚Ç±110,000.' },
  { id: 229, type: 'Problem', topic: 'moving average perpetual problem', q: 'Beg Inv: 2,000 units @ ‚Ç±20. Purch: 3,000 units @ ‚Ç±30. What is the new moving average cost?', options: ['‚Ç±26.00', '‚Ç±25.00', '‚Ç±24.00', '‚Ç±28.00'], a: '‚Ç±26.00', s: '(40,000 + 90,000) / 5,000 = 130,000 / 5,000 = ‚Ç±26.00.' },
  { id: 230, type: 'Problem', topic: 'moving average perpetual problem', q: 'Using data from Q229 (Avg ‚Ç±26), if 4,000 units are sold, calculate COGS.', options: ['‚Ç±104,000', '‚Ç±100,000', '‚Ç±120,000', '‚Ç±110,000'], a: '‚Ç±104,000', s: '4,000 units * ‚Ç±26 = ‚Ç±104,000.' },
  { id: 231, type: 'Problem', topic: 'moving average perpetual problem', q: 'Beg Inv: 100 units @ ‚Ç±500. Purch: 400 units @ ‚Ç±600. Calculate the new moving average unit cost.', options: ['‚Ç±580.00', '‚Ç±550.00', '‚Ç±575.00', '‚Ç±590.00'], a: '‚Ç±580.00', s: '(50,000 + 240,000) / 500 = 290,000 / 500 = ‚Ç±580.' },
  { id: 232, type: 'Problem', topic: 'moving average perpetual problem', q: 'Using data from Q231 (Avg ‚Ç±580), if 300 units are sold, calculate the Cost of Goods Sold.', options: ['‚Ç±174,000', '‚Ç±170,000', '‚Ç±180,000', '‚Ç±165,000'], a: '‚Ç±174,000', s: '300 units * ‚Ç±580 = ‚Ç±174,000.' },
  { id: 233, type: 'Problem', topic: 'moving average perpetual problem', q: 'Beg Inv: 1,000 units @ ‚Ç±10. Purch: 1,000 units @ ‚Ç±14. Sold: 1,500 units. Calculate value of remaining 500 units.', options: ['‚Ç±6,000', '‚Ç±6,500', '‚Ç±5,000', '‚Ç±7,000'], a: '‚Ç±6,000', s: 'Avg = (10k+14k)/2k = 12. Remaining 500 * 12 = ‚Ç±6,000.' },
  { id: 234, type: 'Problem', topic: 'moving average perpetual problem', q: 'Beg Inv: 500 @ ‚Ç±40. Purch: 500 @ ‚Ç±60. Sold 300 units. Calculate COGS.', options: ['‚Ç±15,000', '‚Ç±12,000', '‚Ç±18,000', '‚Ç±16,000'], a: '‚Ç±15,000', s: 'Avg = (20k+30k)/1k = 50. COGS = 300 * 50 = ‚Ç±15,000.' },
  { id: 235, type: 'Problem', topic: 'moving average perpetual problem', q: 'Inv: 2,000 @ ‚Ç±15. Purch: 3,000 @ ‚Ç±20. Sold 2,500. Calculate Ending Inventory value.', options: ['‚Ç±45,000', '‚Ç±40,000', '‚Ç±50,000', '‚Ç±37,500'], a: '‚Ç±45,000', s: 'Avg = (30k+60k)/5k = 18. Rem 2,500 * 18 = ‚Ç±45,000.' },
  { id: 236, type: 'Problem', topic: 'moving average perpetual problem', q: 'Beg 1,000 @ ‚Ç±100. Purch 2,000 @ ‚Ç±130. Sold 1,500. Calculate COGS.', options: ['‚Ç±180,000', '‚Ç±150,000', '‚Ç±195,000', '‚Ç±175,000'], a: '‚Ç±180,000', s: 'Avg = (100k+260k)/3k = 120. COGS = 1,500 * 120 = ‚Ç±180,000.' },
  { id: 237, type: 'Problem', topic: 'moving average perpetual problem', q: 'Beg Inv 500 @ ‚Ç±200. Purch 500 @ ‚Ç±220. Sold 400. Purch 400 @ ‚Ç±235. What is the NEW average cost?', options: ['‚Ç±220.00', '‚Ç±215.00', '‚Ç±225.00', '‚Ç±210.00'], a: '‚Ç±220.00', s: 'Avg1 = 210. Rem 600 @ 210 (126k). New Purch 400 @ 235 (94k). Total 220k / 1k units = ‚Ç±220.' },
  { id: 238, type: 'Problem', topic: 'moving average perpetual problem', q: 'Using data from Q237 (New Avg ‚Ç±220, 1,000 units), what is the total Ending Inventory value?', options: ['‚Ç±220,000', '‚Ç±210,000', '‚Ç±235,000', '‚Ç±200,000'], a: '‚Ç±220,000', s: '1,000 units * ‚Ç±220 = ‚Ç±220,000.' },
  { id: 239, type: 'Problem', topic: 'moving average perpetual problem', q: 'Beg 400 @ ‚Ç±300. Purch 600 @ ‚Ç±350. Sold 800. Calculate COGS.', options: ['‚Ç±264,000', '‚Ç±240,000', '‚Ç±280,000', '‚Ç±250,000'], a: '‚Ç±264,000', s: 'Avg = (120k+210k)/1k = 330. COGS = 800 * 330 = ‚Ç±264,000.' },
  { id: 240, type: 'Problem', topic: 'moving average perpetual problem', q: 'Beg 1,000 @ ‚Ç±80. Purch 1,000 @ ‚Ç±100. Sold 500. Purch 500 @ ‚Ç±110. Calculate Ending Inventory value.', options: ['‚Ç±142,500', '‚Ç±135,000', '‚Ç±145,000', '‚Ç±140,000'], a: '‚Ç±142,500', s: 'Avg1=90. Rem 1.5k @ 90 (135k). Purch 500 @ 110 (55k). Total 190k/2k = 95. EI = 1,500 * 95 = ‚Ç±142,500.' },
  { id: 241, type: 'Problem', topic: 'moving average perpetual problem', q: 'Beg Inv: 100 @ ‚Ç±200. Purch: 100 @ ‚Ç±220. Sold: 50. Calculate COGS.', options: ['‚Ç±10,500', '‚Ç±10,000', '‚Ç±11,000', '‚Ç±12,000'], a: '‚Ç±10,500', s: 'Avg = (20k+22k)/200 = 210. COGS = 50 * 210 = ‚Ç±10,500.' },
  { id: 242, type: 'Problem', topic: 'moving average perpetual problem', q: 'Beg 2,000 @ ‚Ç±10. Purch 3,000 @ ‚Ç±15. Sold 4,000. Purch 1,000 @ ‚Ç±17. Calculate EI Value.', options: ['‚Ç±15,000', '‚Ç±13,000', '‚Ç±17,000', '‚Ç±16,000'], a: '‚Ç±15,000', s: 'Avg1=13. Rem 1k @ 13 (13k). Purch 1k @ 17 (17k). Total 30k/2k = 15. EI = 1,000 * 15 = ‚Ç±15,000.' },
  { id: 243, type: 'Problem', topic: 'moving average perpetual problem', q: 'Beg 500 @ ‚Ç±20. Sold 200. Purch 700 @ ‚Ç±30. Calculate Ending Inventory Value.', options: ['‚Ç±27,000', '‚Ç±25,000', '‚Ç±30,000', '‚Ç±21,000'], a: '‚Ç±27,000', s: 'Rem 300 @ 20 (6k). Purch 700 @ 30 (21k). Total 27k. EI = ‚Ç±27,000.' },
  { id: 244, type: 'Problem', topic: 'moving average perpetual problem', q: 'Beg 5,000 @ ‚Ç±50. Sold 4,000. Purch 4,000 @ ‚Ç±60. Sold 1,000. Calculate COGS of second sale.', options: ['‚Ç±58,000', '‚Ç±50,000', '‚Ç±60,000', '‚Ç±55,000'], a: '‚Ç±58,000', s: 'Rem 1k @ 50 (50k). Purch 4k @ 60 (240k). Total 290k/5k = 58. COGS = 1k * 58 = ‚Ç±58,000.' },
  { id: 245, type: 'Problem', topic: 'moving average perpetual problem', q: 'Inv: 1,000 units. Total Cost ‚Ç±50,000. Purch: 1,000 units. Total Cost ‚Ç±70,000. Sold 1,200. Calculate COGS.', options: ['‚Ç±72,000', '‚Ç±60,000', '‚Ç±84,000', '‚Ç±70,000'], a: '‚Ç±72,000', s: 'Avg = (50k+70k)/2k = 60. COGS = 1,200 * 60 = ‚Ç±72,000.' },
  { id: 246, type: 'Problem', topic: 'moving average perpetual problem', q: 'Beg 2,000 @ ‚Ç±100. Purch 6,000 @ ‚Ç±120. Sold 5,000. Calculate COGS.', options: ['‚Ç±575,000', '‚Ç±500,000', '‚Ç±600,000', '‚Ç±550,000'], a: '‚Ç±575,000', s: 'Avg = (200k+720k)/8k = 115. COGS = 5,000 * 115 = ‚Ç±575,000.' },
  { id: 247, type: 'Problem', topic: 'moving average perpetual problem', q: 'Beg 500 @ ‚Ç±40. Purch 500 @ ‚Ç±50. Sold 500. Purch 500 @ ‚Ç±60. Calculate Ending Inv.', options: ['‚Ç±52,500', '‚Ç±50,000', '‚Ç±55,000', '‚Ç±45,000'], a: '‚Ç±52,500', s: 'Avg1=45. Rem 500 @ 45 (22.5k). Purch 500 @ 60 (30k). Total 52.5k. EI = ‚Ç±52,500.' },
  { id: 248, type: 'Problem', topic: 'moving average perpetual problem', q: 'Beg 10,000 @ ‚Ç±5. Purch 10,000 @ ‚Ç±7. Sold 10,000. Purch 10,000 @ ‚Ç±9. Calculate EI Value.', options: ['‚Ç±150,000', '‚Ç±140,000', '‚Ç±160,000', '‚Ç±130,000'], a: '‚Ç±150,000', s: 'Avg1=6. Rem 10k @ 6 (60k). Purch 10k @ 9 (90k). Total 150k / 20k = 7.5. EI = 20k * 7.5 = ‚Ç±150,000.' },
  { id: 249, type: 'Problem', topic: 'moving average perpetual problem', q: 'Beg 100 @ ‚Ç±1,000. Purch 100 @ ‚Ç±1,200. Sold 150. Calculate COGS.', options: ['‚Ç±165,000', '‚Ç±150,000', '‚Ç±180,000', '‚Ç±160,000'], a: '‚Ç±165,000', s: 'Avg = (100k+120k)/200 = 1,100. COGS = 150 * 1,100 = ‚Ç±165,000.' },
  { id: 250, type: 'Problem', topic: 'moving average perpetual problem', q: 'Using data from Q249 (Avg ‚Ç±1,100), what is the value of the remaining 50 units?', options: ['‚Ç±55,000', '‚Ç±50,000', '‚Ç±60,000', '‚Ç±52,500'], a: '‚Ç±55,000', s: '50 units * ‚Ç±1,100 = ‚Ç±55,000.' }
];
        
        // --- STATE MANAGEMENT ---
        let activeTestParts = { 1: [], 2: [], 3: [] };
        let currentPart = 1;
        let currentQuestionIndex = 0;
        let studentInfo = {};
        let studentAnswers = { 1: {}, 2: {}, 3: {} };
        let timerInterval;
        let timeRemaining; // Seconds
        let testActive = false; // Flag for anti-cheat

        // --- ENHANCEMENT: ANTI-CHEAT VARIABLES ---
        let unlockClicks = 0; // Counts clicks to return focus

        // --- INITIALIZATION LOGIC ---
        window.initializeTest = function() {
            const cn = document.getElementById('class-number').value.trim();
            const fn = document.getElementById('full-name').value.trim();
            const gs = document.getElementById('grade-section').value.trim();
            const idNumber = document.getElementById('id-number').value.trim();

            if(!cn || !fn || !gs) {
                alert("Please complete verification first.");
                return;
            }

            studentInfo = { cn, fn, gs, idNumber };
            document.getElementById('student-display-name').innerText = `${fn} (${gs})`;
            document.getElementById('student-info-section').classList.add('hidden');
            document.getElementById('main-interface').classList.remove('hidden');
            document.body.classList.remove('no-scroll');
            document.getElementById('timer-bar').classList.remove('hidden');

            generateQuestions();
            renderQuestionUI();
            
            // Set flag
            testActive = true;
            
            // Start Timers and Monitors
            startTimer();
            enableAntiCheat(); 
        }

        // --- ENHANCEMENT: ANTI-CHEAT LOGIC ---
        function enableAntiCheat() {
            // 1. Monitor Tab Switching / Window Minifying
            document.addEventListener('visibilitychange', handleVisibilityChange);
            window.addEventListener('blur', handleWindowBlur);

            // 2. Monitor Copy/Paste shortcuts
            document.addEventListener('keydown', handleKeyGuard);
            
            // 3. Monitor Context Menu is already disabled in <body> tag
        }

        function handleVisibilityChange() {
            if (document.hidden && testActive) {
                showLockout();
            }
        }

        function handleWindowBlur() {
            // Only trigger if test is active and we haven't already finished
            if (testActive) {
                showLockout();
            }
        }

        function showLockout() {
            const lockout = document.getElementById('cheat-lockout');
            lockout.classList.remove('hidden');
            // Reset click counter
            unlockClicks = 0;
            updateUnlockButton();
        }

        window.handleUnlockClick = function() {
            unlockClicks++;
            const clicksNeeded = 3 - unlockClicks;
            
            if (clicksNeeded <= 0) {
                // Unlock
                document.getElementById('cheat-lockout').classList.add('hidden');
                unlockClicks = 0;
            } else {
                updateUnlockButton();
            }
        }

        function updateUnlockButton() {
            const btn = document.getElementById('btn-unlock');
            const remaining = 3 - unlockClicks;
            btn.innerText = `Resume Test (${remaining})`;
            
            // Visual feedback animation
            btn.classList.add('scale-95');
            setTimeout(() => btn.classList.remove('scale-95'), 100);
        }

        // Key Guard for Shortcuts
        function handleKeyGuard(e) {
            if (!testActive) return;

            // Detect PrintScreen
            if (e.key === 'PrintScreen') {
                triggerBlackCurtain();
            }

            // Detect Ctrl+C, Ctrl+V, Ctrl+X, Ctrl+Shift+S (Snipping tool combos)
            if ((e.ctrlKey || e.metaKey) && 
                (['c', 'v', 'x', 'p', 's'].includes(e.key.toLowerCase()))) {
                e.preventDefault();
                triggerBlackCurtain();
                alert("Security Warning: Copying or Screenshots are not allowed.");
            }
        }

        function triggerBlackCurtain() {
            const curtain = document.getElementById('black-curtain');
            curtain.style.display = 'block';
            
            // Keep it black for 2 seconds then fade out? 
            // Or just flash it. Let's keep it for 500ms to ruin the screenshot
            setTimeout(() => {
                curtain.style.display = 'none';
            }, 1000);
        }

        // -------------------------------------

        function startTimer() {
            timeRemaining = window.examDurationMins * 60;
            updateTimerDisplay();
            timerInterval = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                if (timeRemaining <= 0) {
                    clearInterval(timerInterval);
                    alert("Time is up! Submitting your answers.");
                    // AUTO SUBMIT UPON EXPIRATION
                    window.finishAndPreview(true);
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const h = Math.floor(timeRemaining / 3600);
            const m = Math.floor((timeRemaining % 3600) / 60);
            const s = timeRemaining % 60;
            document.getElementById('timer-display').innerText = 
                `${h.toString().padStart(2,'0')}:${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
            
            if(timeRemaining < 300) { // Red alert last 5 mins
                document.getElementById('timer-bar').classList.add('animate-pulse');
            }
        }

        function generateQuestions() {
            // Logic matches original provided logic
            const pool1 = allQuestionsPool.filter(q => ['merchandising foundations', 'fifo periodic theory', 'weighted average periodic theory', 'fifo perpetual theory', 'moving average perpetual theory'].includes(q.topic));
            const pool2 = allQuestionsPool.filter(q => ['fifo periodic problem', 'weighted average periodic problem', 'fifo perpetual problem', 'moving average perpetual problem'].includes(q.topic));
            
            activeTestParts[1] = getRandomSubset(pool1, 50);
            activeTestParts[2] = getRandomSubset(pool2, 25);
        }

        function getRandomSubset(arr, size) {
            // If pool is smaller than requested size (for testing), return all
            if (arr.length <= size) return arr;
            const shuffled = [...arr].sort(() => 0.5 - Math.random());
            return shuffled.slice(0, size);
        }

        // --- NAVIGATION LOGIC ---
        window.switchTestPart = function(partNum) {
            currentPart = partNum;
            currentQuestionIndex = 0;
            renderQuestionUI();
        }

        window.nextQuestion = function() {
            if(currentQuestionIndex < activeTestParts[currentPart].length - 1) {
                currentQuestionIndex++;
                renderQuestionUI();
            }
        }

        window.prevQuestion = function() {
            if(currentQuestionIndex > 0) {
                currentQuestionIndex--;
                renderQuestionUI();
            }
        }

        window.jumpToQuestion = function(index) {
            currentQuestionIndex = index;
            renderQuestionUI();
        }

        // --- RENDERING LOGIC ---
        function renderQuestionUI() {
            // Update Tabs
            [1, 2].forEach(n => {
                const tab = document.getElementById(`tab-${n}`);
                if(n === currentPart) {
                    tab.classList.add('text-blue-800', 'border-blue-500', 'bg-white');
                    tab.classList.remove('text-gray-500', 'border-transparent');
                } else {
                    tab.classList.remove('text-blue-800', 'border-blue-500', 'bg-white');
                    tab.classList.add('text-gray-500', 'border-transparent');
                }
            });

            const questions = activeTestParts[currentPart];
            if(questions.length === 0) return;

            const q = questions[currentQuestionIndex];
            let optionsHtml = '';
            
            q.options.forEach((opt, i) => {
                const isChecked = studentAnswers[currentPart][q.id] === opt ? 'checked' : '';
                optionsHtml += `
                    <label class="flex items-start p-3 border rounded-lg hover:bg-blue-50 cursor-pointer transition-colors ${isChecked ? 'bg-blue-50 border-blue-400' : 'border-gray-200'}">
                        <input type="radio" name="q_${q.id}" value="${opt.replace(/"/g, '&quot;')}" 
                            onchange="saveAnswer(${q.id}, this.value)" class="mt-1 mr-3 text-blue-600" ${isChecked}>
                        <span class="text-gray-700 text-sm md:text-base font-serif">${opt}</span>
                    </label>
                `;
            });

            document.getElementById('question-content').innerHTML = `
                <div class="mb-4">
                    <span class="inline-block px-2 py-1 text-xs font-semibold text-blue-800 bg-blue-100 rounded mb-2">
                        ${q.type} - ${q.topic}
                    </span>
                    <h3 class="text-lg md:text-xl font-bold text-gray-800 leading-relaxed font-serif">
                        ${currentQuestionIndex + 1}. ${q.q}
                    </h3>
                </div>
                <div class="space-y-3">
                    ${optionsHtml}
                </div>
            `;

            document.getElementById('btn-prev').disabled = currentQuestionIndex === 0;
            document.getElementById('btn-prev').classList.toggle('opacity-50', currentQuestionIndex === 0);
            
            document.getElementById('btn-next').disabled = currentQuestionIndex === questions.length - 1;
            document.getElementById('btn-next').classList.toggle('opacity-50', currentQuestionIndex === questions.length - 1);

            document.getElementById('question-counter').innerText = `${currentQuestionIndex + 1} / ${questions.length}`;

            // Render Palette
            const palette = document.getElementById('question-palette');
            palette.innerHTML = '';
            questions.forEach((que, idx) => {
                const hasAnswer = studentAnswers[currentPart][que.id] !== undefined;
                const isActive = idx === currentQuestionIndex;
                let classes = 'q-dot';
                if (isActive) classes += ' active';
                if (hasAnswer) classes += ' answered';
                
                palette.innerHTML += `<div class="${classes}" onclick="window.jumpToQuestion(${idx})">${idx + 1}</div>`;
            });
        }

        window.saveAnswer = function(qId, value) {
            studentAnswers[currentPart][qId] = value;
            renderQuestionUI();
        }

        // --- GRADING, SUBMISSION & PRINTING LOGIC ---

        // NEW LOGIC: Submit first, then preview/download
        window.finishAndPreview = async function(isAutoSubmit = false) {
            if(!isAutoSubmit) {
                if(!confirm("Are you sure you want to submit your exam? You cannot change answers after this.")) return;
            }

            // Stop Timer
            clearInterval(timerInterval);
            document.getElementById('timer-bar').classList.add('hidden');

            // DISABLE ANTI-CHEAT (So they can print/pdf without black screens)
            testActive = false;

            // Prepare Data
            const fullData = {
                studentInfo: studentInfo,
                answers: studentAnswers,
                questions: activeTestParts,
                timestamp: new Date().toISOString(),
                scoreData: calculateScores()
            };

            // 1. SUBMIT TO FIREBASE
            const saved = await window.saveResultsToFirebase(fullData);

            if (saved) {
                // 2. GENERATE REPORT AND SHOW MODAL
                generateReportHTML();
                document.getElementById('print-preview-modal').classList.remove('hidden');
                
                // 3. UPDATE BUTTONS (No "Keep Answering", Only "Download PDF")
                const actionsDiv = document.getElementById('preview-actions');
                actionsDiv.innerHTML = `
                    <button onclick="window.downloadPDF()" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 font-bold font-serif shadow-md">
                        Download PDF Result
                    </button>
                `;
                
                // Hide the overlay (it was shown by saveResultsToFirebase)
                document.getElementById('submission-overlay').classList.add('hidden');
                document.getElementById('main-interface').classList.add('hidden'); // Hide quiz
            } else {
                // If failed, remove overlay so they can try again.
                document.getElementById('submission-overlay').classList.add('hidden');
                // Re-enable manual submit if it wasn't auto (auto failed = stuck, but user can see error and try refreshing or manual)
                if (!isAutoSubmit) {
                     document.getElementById('timer-bar').classList.remove('hidden');
                     startTimer();
                     testActive = true; // Re-enable anti-cheat
                }
            }
        }

        function calculateScores() {
           let scores = {};
           [1,2,3].forEach(part => {
                scores[part] = gradePart(part);
           });
           return scores;
        }

        function gradePart(partNum) {
            const questions = activeTestParts[partNum];
            let score = 0;
            const graded = questions.map(q => {
                const ans = studentAnswers[partNum][q.id];
                // Fix for Firebase error: Ensure ans is not undefined
                const cleanAns = (ans === undefined) ? null : ans;
                
                const isCorrect = ans === q.a;
                if(isCorrect) score++;
                return { ...q, studentAns: cleanAns, isCorrect };
            });
            return { score, total: questions.length, details: graded };
        }

        function getLetterGrade(percentage) {
            if(percentage >= 95) return 'A';
            if(percentage >= 85) return 'P';
            if(percentage >= 75) return 'D';
            return 'IR'; 
        }

        function generateReportHTML() {
            const container = document.getElementById('print-content');
            const date = new Date().toLocaleDateString();
            const timeStr = new Date().toLocaleTimeString();

            let html = `
            <div class="text-center border-b-2 border-gray-800 pb-4 mb-6 font-serif">
              <img src="./shs-adc-logo.png" alt="School Logo" class="mx-auto mb-2 h-20 w-auto" />
              <p class="text-sm mt-1">SY 2025-2026 | 2nd Semester</p>
              <h1 class="text-xl font-bold uppercase mt-2">T2 Summative Test 01</h1>
              <h1 class="text-2xl font-bold uppercase mb-4">FABM 1</h1>

              <div class="flex justify-between text-sm mt-1 text-left border-t border-gray-300 pt-2">
                <div>
                    <p>CN: <b>${studentInfo.cn}</b></p>
                    <p>Name: <b>${studentInfo.fn}</b></p>
                </div>
                <div class="text-right">
                    <p>Section: <b>${studentInfo.gs}</b></p>
                    <p>Date: ${date} ${timeStr}</p>
                </div>
              </div>
            </div>
            `;

            const competencies = {
                1: "To understand the mechanics of the Periodic and Perpetual Inventory System.",
                2: "To analyze how the inventory cost flows from Purchases to Cost of Goods Sold(COGS) under FIFO, Weighted Average, and Moving Average costing methods.",                
            };

            const parts = [
                { id: 1, title: "Test 1: Multiple Choice Theory" },
                { id: 2, title: "Test 2: Multiple Choice Problem Solving" }
            ];

            let overallScore = 0;
            let overallTotal = 0;

            parts.forEach(part => {
                const result = gradePart(part.id);
                overallScore += result.score;
                overallTotal += result.total;
                const pct = result.total > 0 ? ((result.score / result.total) * 100).toFixed(1) : 0;
                const partLetterGrade = getLetterGrade(pct);

                html += `
                    <div class="mb-8 break-inside-avoid font-serif">
                        <div class="bg-gray-100 p-3 rounded-t mb-0 flex justify-between items-center border-l-4 border-blue-600">
                            <h2 class="font-bold text-lg">${part.title}</h2>
                            <span class="font-bold text-blue-800">${result.score} / ${result.total} (${pct}%) - Grade: ${partLetterGrade}</span>
                        </div>
                        
                        <div class="print-rubric rounded-b border-t-0">
                            <div class="mb-1"><strong>Competency:</strong> ${competencies[part.id]}</div>
                            <div><strong>Criteria:</strong> 95-100%(A), 85-94.9%(P), 75-84.9%(D), <75%(IR)</div>
                        </div>
                `;

                result.details.forEach((item, idx) => {
                    // LOGIC CHANGE: Handle Unanswered Questions
                    let statusHtml = '';
                    let explanationHtml = '';
                    let statusClass = '';

                    if (!item.studentAns) {
                        // UNANSWERED
                        statusClass = 'bg-gray-100 border border-gray-300 rounded p-2 mt-1';
                        statusHtml = '<span class="text-gray-500 font-bold italic">Student did not answer</span>';
                        explanationHtml = ''; // Hide correct answer and explanation
                    } else if (item.isCorrect) {
                        // CORRECT
                        statusClass = 'feedback-correct';
                        statusHtml = '<span class="text-green-700 font-bold">‚úì Correct</span>';
                        explanationHtml = '';
                        // explanationHtml = `<div class="text-xs mt-1 text-gray-500">${item.s}</div>`;
                    } else {
                        // INCORRECT
                        statusClass = 'feedback-incorrect';
                        statusHtml = '<span class="text-red-700 font-bold">‚úó Incorrect</span>';
                        explanationHtml = `<div class="text-xs mt-1"><b>Correct Answer:</b> ${item.a}<br><b>Explanation:</b> ${item.s}</div>`;
                    }

                    html += `
                        <div class="mb-4 pb-4 border-b border-gray-200 text-sm break-inside-avoid">
                            <p class="font-semibold mb-1">${idx + 1}. ${item.q}</p>
                            <div class="ml-4">
                                <p class="text-gray-600">Student Answer: <span class="font-mono font-bold">${item.studentAns || '(No Answer)'}</span></p>
                                <div class="${statusClass}">
                                    ${statusHtml}
                                    ${explanationHtml}
                                </div>
                            </div>
                        </div>
                    `;
                });

                html += `</div>`; 
            });

            const grandPct = overallTotal > 0 ? ((overallScore / overallTotal) * 100).toFixed(1) : 0;
            const overallLetter = getLetterGrade(grandPct);

            html += `
                <div class="mt-8 p-6 bg-blue-900 text-white rounded-xl text-center break-inside-avoid font-serif">
                    <h3 class="text-xl font-bold uppercase">Overall Performance</h3>
                    <div class="text-4xl font-extrabold mt-2">${overallScore} / ${overallTotal}</div>
                    <div class="text-2xl font-light mt-1">${grandPct}% - Rating: ${overallLetter}</div>
                </div>
            `;

            html += `
                <div class="print-footer">
                    <div class="footer-line-1">
                        <span class="text-left">FABM 1</span>
                        <span class="text-right">Page 1 of 1</span>
                    </div>
                    <div class="footer-line-2">
                        <div class="footer-box">4Cs: Christ-centeredness, Competence, Character, Compassion</div>
                    </div>
                </div>
            `;

            container.innerHTML = html;
        }

        window.downloadPDF = function() {
            const element = document.getElementById('print-content');
            const filename = `SummativeTest_${studentInfo.cn}_${studentInfo.gs}.pdf`;
            
            const opt = {
                margin: 0.5,
                filename: filename,
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2, useCORS: true },
                jsPDF: { unit: 'in', format: [8.5, 13], orientation: 'portrait' }
            };

            html2pdf().set(opt).from(element).save();
        }

    </script>
</body>
</html>
